(this["webpackJsonpdeliveryPay-react"]=this["webpackJsonpdeliveryPay-react"]||[]).push([[3],{164:function(e,t,n){"use strict";n.r(t),n.d(t,"Chat",(function(){return v}));var c=n(23),s=n.n(c),a=n(28),i=n(13),r=n(10),l=n(3),o=n(1),j=n(4),u=n(2),d=n(12),b=n(17),h=n(9),O=n(175),m=n(0),f=Object(o.lazy)((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,158)).then((function(e){return{default:e.MilestoneForm}}))}));n(240);var x=function(e){fetch("/api/updateLastSeen",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rooms:e})})},p=function(e){var t=e.setUserCard,n=e.setContacts,c=Object(j.g)(),s=Object(o.useState)(null),a=Object(l.a)(s,2),r=a[0],d=a[1],O=Object(o.useState)([]),f=Object(l.a)(O,2),x=f[0],p=f[1],g=Object(o.useState)(""),v=Object(l.a)(g,2),k=v[0],C=v[1],y=Object(o.useState)(!1),N=Object(l.a)(y,2),S=N[0],w=N[1],_=Object(o.useRef)(),M=Object(o.useCallback)((function(){new RegExp(/^(\+91|91|1|)(?=\d{10}$)/gi).test(k.toLowerCase())?fetch("/api/inviteUser?".concat(new URLSearchParams({q:"+91"+k.replace(/^(\+91|91|1|)(?=\d{10}$)/g,""),origin:window.location.origin}).toString())).then((function(e){return e.json()})).then((function(e){"ok"===e.code?d(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return d(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.C,{}),Object(m.jsxs)("h4",{children:["An invitaion has been sent to"," ","+91"+k.replace(/^(\+91|91|1|)(?=\d{10}$)/g,""),"."]})]})]})):d(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return d(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Invitation could not be sent. Please try again."})]})]}))})).catch((function(e){console.log(e),d(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return d(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Invitation could not be sent. Make sure you're online."})]})]}))})):d(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return d(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Enter a valid phone number to send invitation."})]})]}))}),[k]),F=function(e){e.path.includes(_.current)||w(!1)};return Object(o.useEffect)((function(){return document.addEventListener("click",F),function(){document.removeEventListener("click",F)}}),[]),Object(o.useEffect)((function(){k?(fetch("/api/getUsers?q=".concat(encodeURIComponent(k))).then((function(e){return e.json()})).then((function(e){e&&p(e)})),""===k&&p([])):p([])}),[k]),Object(m.jsxs)("div",{className:"search",children:[Object(m.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},ref:_,children:[Object(m.jsxs)("section",{children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"17.9",height:"17.9",viewBox:"0 0 17.9 17.9",children:Object(m.jsx)("path",{id:"Path_208","data-name":"Path 208",d:"M17.9,16.324l-3.715-3.715a7.708,7.708,0,0,0,1.576-4.728A7.832,7.832,0,0,0,7.881,0,7.832,7.832,0,0,0,0,7.881a7.832,7.832,0,0,0,7.881,7.881,7.708,7.708,0,0,0,4.728-1.576L16.324,17.9ZM2.252,7.881A5.574,5.574,0,0,1,7.881,2.252a5.574,5.574,0,0,1,5.629,5.629,5.574,5.574,0,0,1-5.629,5.629A5.574,5.574,0,0,1,2.252,7.881Z",transform:"translate(0)",fill:"#b9b9b9"})}),Object(m.jsx)("input",{label:"search",required:!0,placeholder:"Phone Number",onFocus:function(){return w(!0)},value:k,onChange:function(e){return C(e.target.value)}}),Object(m.jsx)(u.b,{className:"sendReq ".concat(x.length>0||!k?"disabled":""),onClick:M,to:"#",children:"Invite"})]}),S&&x.length?Object(m.jsx)("ul",{className:"searchResult",children:x.map((function(e,s){return Object(m.jsx)("a",{onClick:function(){t(e),n((function(t){return[].concat(Object(i.a)(t),[{client:e,messages:[],status:""}])})),c.push("/account/deals/".concat(e._id)),w(!1)},children:Object(m.jsx)("li",{children:Object(m.jsxs)("div",{className:"profile",children:[Object(m.jsx)(h.n,{src:e.profileImg}),Object(m.jsxs)("p",{className:"name",children:[e.firstName+" "+e.lastName,Object(m.jsx)("span",{className:"phone",children:e.phone})]})]})},s)},s)}))}):null]}),Object(m.jsx)(b.Modal,{className:"msg",open:r,children:r})]})},g=function(e){var t=e.client,n=e.messages,c=(e.lastSeen,e.userCard),s=e.unread,a=Object(o.useContext)(d.a).setContacts,i=Object(j.g)();return Object(m.jsx)("li",{className:t._id===(null===c||void 0===c?void 0:c._id)?"active":void 0,onClick:function(){i.push("/account/deals/".concat(t._id)),a((function(e){return e.map((function(e){var n;return(null===t||void 0===t?void 0:t._id)===(null===(n=e.client)||void 0===n?void 0:n._id)?Object(r.a)(Object(r.a)({},e),{},{lastSeen:(new Date).toISOString(),unread:null}):e}))}))},children:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(h.n,{src:t.profileImg||"/profile-user.jpg"}),Object(m.jsxs)("div",{children:[Object(m.jsx)("p",{className:"name",children:t.firstName?t.firstName+" "+t.lastName:"Deleted User"}),n.length>0&&Object(m.jsx)("p",{className:"lastMessage",children:n[n.length-1].text}),s?Object(m.jsx)("p",{className:"unread",children:s}):null]})]})})},v=function(e){var t=e.chat,n=e.setChat,c=e.userCard,s=e.setUserCard,a=e.user,O=e.setContacts,p=Object(o.useContext)(d.d),g=p.setUser,v=p.userType,C=Object(o.useContext)(d.a),S=C.rooms,w=(C.setRooms,Object(o.useRef)(null)),_=Object(o.useRef)(null),M=Object(j.g)(),F=Object(o.useState)(!1),R=Object(l.a)(F,2),U=R[0],P=R[1],D=Object(o.useState)(!((null===t||void 0===t?void 0:t.length)>=50)),E=Object(l.a)(D,2),L=E[0],Y=E[1],q=Object(o.useState)(2),A=Object(l.a)(q,2),T=A[0],I=A[1],H=Object(o.useState)(null),B=Object(l.a)(H,2),$=B[0],J=B[1];Object(o.useEffect)((function(){return S.length&&x(S),function(){S.length&&x(S)}}),[S]);return Object(o.useEffect)((function(){(null===t||void 0===t?void 0:t.length)>=50?Y(!1):Y(!0)}),[t]),Object(m.jsxs)("div",{className:"chat",children:[t?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{className:"chatHead",children:[Object(m.jsxs)("div",{className:"profile",children:[Object(m.jsx)("button",{className:"back",onClick:function(){M.push("/account/deals"),n(null),s(null)},children:Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",children:Object(m.jsx)("path",{id:"Path_10","data-name":"Path 10",d:"M8,0,6.545,1.455l5.506,5.506H0V9.039H12.052L6.545,14.545,8,16l8-8Z",transform:"translate(16 16) rotate(180)",fill:"#2699fb"})})}),Object(m.jsx)(h.n,{src:c.profileImg||"/profile-user.jpg"}),Object(m.jsxs)("p",{className:"name",children:[c.firstName?c.firstName+" "+c.lastName:"Deleted user",c.lastSeen&&Object(m.jsx)("span",{className:"lastSeen",children:Object(m.jsx)(h.s,{format:"hh:mma, MMM DD",children:c.lastSeen})})]})]}),(""===c.status||"blocked"===c.status)&&Object(m.jsxs)(m.Fragment,{children:["seller"===v?Object(m.jsx)(u.b,{className:"pay",to:"/account/deals/".concat(c._id,"/payment"),children:"Request Milestone"}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(u.b,{className:"pay",to:"/account/deals/".concat(c._id,"/payment"),children:"Pay"}),Object(m.jsx)(u.b,{className:"viewShop",to:"/marketplace?seller=".concat(c._id),children:"View Shop"})]}),Object(m.jsxs)(h.a,{children:[""===c.status&&null,Object(m.jsx)(u.b,{to:"/account/deals/".concat(c._id,"/report"),children:"Report"}),Object(m.jsx)("button",{onClick:function(){Object(b.Confirm)({label:" ".concat("blocked"===c.status?"Unblock":"Block"," User"),question:"You sure want to ".concat("blocked"===c.status?"un":"","block this user?"),callback:function(){var e="blocked"===c.status;fetch("/api/".concat(e?"unblockUser":"blockUser"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:c._id})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?(g((function(e){return Object(r.a)(Object(r.a)({},e),{},{blockList:t.blockList})})),O((function(t){return t.map((function(t){return t.client._id===c._id?Object(r.a)(Object(r.a)({},t),{},{status:e?"":"blocked"}):t}))})),J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.C,{}),Object(m.jsxs)("h4",{children:["User successfully ",e&&"un","blocked."]})]})]}))):J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsxs)("h4",{children:["Could not ",e&&"un","block user. try again."]})]})]}))})).catch((function(t){console.log(t),J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsxs)("h4",{children:["Could not ",e&&"un","block user. Make sure you're online."]})]})]}))}))}})},children:"blocked"===c.status?"Unblock":"Block"})]})]})]}),Object(m.jsxs)("ul",{className:"chats",ref:w,onScroll:function(e){var t;((null===(t=_.current)||void 0===t?void 0:t.getBoundingClientRect())||{}).y>0&&!U&&(P(!0),fetch("/api/getMessages?client=".concat(c._id,"&page=").concat(T)).then((function(e){return e.json()})).then((function(e){P(!1),"ok"===e.code&&(O((function(t){return t.map((function(t){var n;return t._id===(null===(n=e.contact)||void 0===n?void 0:n._id)?Object(r.a)(Object(r.a)({},t),{},{messages:e.contact.messages}):t}))})),I((function(e){return e+1})),e.contact.total===e.contact.messages.length&&Y(!0))})).catch((function(e){P(!1),console.log(e),J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Could not get messages. Make sure you're online."})]})]}))})))},children:[Object(i.a)(t.map((function(e,n){return Object(m.jsx)(k,{chat:t,msg:e,i:n,user:a},e._id)}))).reverse(),!L&&Object(m.jsx)("li",{className:"loading",ref:_,children:"Loading"})]}),""===c.status&&Object(m.jsx)(y,{onSuccess:function(){var e;null===(e=w.current)||void 0===e||e.scrollBy(0,2*w.current.scrollHeight)},rooms:S,user:c._id,newChat:!c.lastSeen})]}):Object(m.jsxs)("div",{className:"startChat",children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26.55",height:"25.219",viewBox:"0 0 26.55 25.219",children:Object(m.jsx)("path",{id:"Path_1","data-name":"Path 1",d:"M-242.2-184.285h-13l26.55-10.786-4.252,25.219-5.531-10.637-2.127,4.68v-6.382l7.659-9.148h2.34",transform:"translate(255.198 195.071)",fill:"#707070"})}),Object(m.jsx)("p",{children:"start a chat"})]}),Object(m.jsx)(b.Modal,{className:"milestoneRequest",head:!0,label:"seller"===v?"Request Milestone":"Create Milestone",open:c&&M.location.pathname.match(/^\/account\/deals\/.+\/payment$/),setOpen:function(){return M.push("/account/deals/".concat(c._id))},children:Object(m.jsx)(f,{action:"seller"===v?"request":"create",client:c,onSuccess:function(e){var t;M.push("/account/deals/".concat(c._id)),J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.C,{}),Object(m.jsxs)("h4",{className:"amount",children:["\u20b9",null===(t=e.milestone)||void 0===t?void 0:t.amount]}),Object(m.jsx)("h4",{children:"Milestone has been created"})]}),Object(m.jsx)(u.b,{to:"/account/hold",onClick:function(){return J(null)},children:"Check your Delivery pay Hold"})]}))}})}),Object(m.jsx)(j.b,{path:"/account/deals/:_id/report",component:function(e){var t=e.location;return Object(m.jsx)(b.Modal,{open:!0,head:!0,label:"Report User",className:"userReport",setOpen:function(){return M.push(t.pathname.replace(/\/report/,""))},children:Object(m.jsx)("div",{className:"content",children:Object(m.jsx)(N,{user:c,onSuccess:function(){M.push(M.location.pathname.replace(/\/report/,"")),J(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.C,{}),Object(m.jsx)("h4",{children:"User has been reported."})]})]}))}})})})}}),Object(m.jsx)(b.Modal,{className:"msg",open:$,children:$})]})},k=function(e){var t,n,c=e.chat,s=e.msg,a=e.i,i=e.user,r=Object(j.g)(),u=Object(o.useState)(null),d=Object(l.a)(u,2),b=d[0],O=d[1];if(Object(o.useEffect)((function(){s.milestoneId&&fetch("/api/milestone?q=".concat(s.milestoneId)).then((function(e){return e.json()})).then((function(e){e.milestones.length&&O(e.milestones[0])}))}),[]),!s)return null;var f=Math.abs(new Date(s.createdAt).getTime()-new Date(null===(t=c[a+1])||void 0===t?void 0:t.createdAt).getTime())>12e4,x=Object(h.L)({time:s.createdAt,format:"YYYY-MM-DD"})!==Object(h.L)({time:null===(n=c[a-1])||void 0===n?void 0:n.createdAt,format:"YYYY-MM-DD"})||0===a;return Object(m.jsxs)("li",{className:"bubble ".concat(s.from===i._id?"user":"client"," ").concat(b?"milestone":""),children:[x&&Object(m.jsx)(h.s,{className:"dateStamp",format:"MMM DD, YYYY",children:s.createdAt}),s.text&&Object(m.jsxs)("p",{className:"text",onClick:function(){b&&r.push("/account/hold?q=".concat(b._id))},children:[b&&Object(m.jsxs)("span",{className:"amount",children:["\u20b9",b.amount]}),s.text]}),s.media&&Object(m.jsx)(C,{link:s.media}),(f||a===c.length-1)&&Object(m.jsx)(h.s,{className:"timestamp",format:"hh:mm a",children:s.createdAt})]})},C=function(e){var t=e.link,n=null,c=null,s=Object(o.useState)(!1),a=Object(l.a)(s,2),i=a[0],r=a[1];return t.match(/(\.gif|\.png|\.jpg|\.jpeg|\.webp)$/i)?n=Object(m.jsx)(h.n,{src:t,onClick:function(){return r(!0)}}):t.match(/(\.mp3|\.ogg|\.amr|\.m4a|\.flac|\.wav|\.aac)$/i)?n=Object(m.jsx)("audio",{src:t,controls:"on"}):t.match(/(\.mp4|\.mov|\.avi|\.flv|\.wmv|\.webm)$/i)?(n=Object(m.jsxs)("div",{className:"videoThumb",children:[Object(m.jsx)("video",{src:t,onClick:function(){return r(!0)}}),Object(m.jsx)(h.n,{src:"/play_btn.png"})]}),c=Object(m.jsx)("video",{src:t,controls:"on",autoPlay:"on"})):n=Object(m.jsxs)("a",{href:t,target:"_blank",className:"link",children:[Object(m.jsx)(h.n,{src:"/file_icon.png"}),t]}),Object(m.jsxs)("div",{className:"file",children:[n,Object(m.jsxs)(b.Modal,{open:i,className:"chatMediaView",children:[Object(m.jsx)("button",{className:"close",onClick:function(){return r(!1)},children:Object(m.jsx)(h.H,{})}),c||n]})]})},y=function(e){var t=e.rooms,n=e.user,c=e.newChat,j=Object(o.useRef)(null),u=Object(o.useRef)(null),f=Object(o.useState)(null),x=Object(l.a)(f,2),p=x[0],g=x[1],v=Object(o.useState)(!1),k=Object(l.a)(v,2),C=k[0],y=(k[1],Object(o.useState)("")),N=Object(l.a)(y,2),w=N[0],_=N[1],M=Object(o.useState)([]),F=Object(l.a)(M,2),R=F[0],U=F[1],P=function(){var e=Object(a.a)(s.a.mark((function e(a){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),d.e.connected){e.next=4;break}return g(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return g(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Could not connect to server. Make sure you're online."})]})]})),e.abrupt("return");case 4:if("https://cdn.deliverypay.in",!R.length){e.next=11;break}return e.next=8,Object(h.F)({files:R,setMsg:g});case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=[];case 12:if(i=e.t0,!R.length||i.length){e.next=16;break}return g(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return g(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Could not send files. please try again."})]})]})),e.abrupt("return");case 16:i.length&&(i.forEach((function(e,s){d.e.emit("messageToServer",Object(r.a)(Object(r.a)({rooms:t},c&&{newChat:c}),{},{message:{to:n,media:e}}))})),U([])),w&&t.length&&(d.e.emit("messageToServer",Object(r.a)(Object(r.a)({rooms:t},c&&{newChat:c}),{},{message:{to:n,text:w}})),j.current.focus(),_(""));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.useEffect)((function(){d.e.on("sendFail",(function(e){var t=e.err;g(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return g(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:t})]})]}))}))}),[]),Object(o.useEffect)((function(){d.e.connected||d.e.connect()}),[w,R]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("form",{onSubmit:P,ref:u,className:C?"loading":"",children:[Object(m.jsx)(S,{files:R,setFiles:U}),Object(m.jsxs)("section",{children:[Object(m.jsx)(O.a,{autoFocus:!0,ref:j,type:"text",value:w,style:{height:"100px"},onChange:function(e){return _(e.target.value)},onKeyDown:function(e){13!==e.keyCode||e.altKey?13===e.keyCode&&e.altKey&&_(w+"\n"):P(e)}}),Object(m.jsxs)("div",{className:"fileUpload",children:[Object(m.jsx)("input",{type:"file",multiple:!0,onChange:function(e){U((function(t){return[].concat(Object(i.a)(t),Object(i.a)(Object(i.a)(e.target.files).filter((function(e){return!R.some((function(t){return t.name===e.name}))}))))}))}}),Object(m.jsx)(h.n,{src:"/paperclip.svg"})]})]}),Object(m.jsx)("button",{type:"submit",disabled:C,children:Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26.55",height:"25.219",viewBox:"0 0 26.55 25.219",children:Object(m.jsx)("path",{id:"Path_1","data-name":"Path 1",d:"M-242.2-184.285h-13l26.55-10.786-4.252,25.219-5.531-10.637-2.127,4.68v-6.382l7.659-9.148h2.34",transform:"translate(255.198 195.071)",fill:"#fff"})})})]}),Object(m.jsx)(b.Modal,{open:p,className:"msg",children:p})]})},N=function(e){var t=e.user,n=e.onSuccess,c=Object(o.useState)(!1),s=Object(l.a)(c,2),a=s[0],i=s[1],r=Object(o.useState)(""),j=Object(l.a)(r,2),u=j[0],d=j[1],f=Object(o.useState)(null),x=Object(l.a)(f,2),p=x[0],g=x[1];return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),i(!0),fetch("/api/reportUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t._id,message:u})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?null===n||void 0===n||n(e):g(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return g(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Report could not be submitted. try again."})]})]}))})).catch((function(e){console.log(e),g(Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:function(){return g(null)},children:"Okay"}),Object(m.jsxs)("div",{children:[Object(m.jsx)(h.i,{}),Object(m.jsx)("h4",{children:"Report could not be submitted. Make sure you're online."})]})]}))}))},children:[Object(m.jsxs)("section",{children:[Object(m.jsx)("label",{children:"Messag"}),Object(m.jsx)(O.a,{required:!0,onChange:function(e){return d(e.target.value)}})]}),Object(m.jsx)("section",{className:"btns",children:Object(m.jsx)("button",{className:"submit",children:"Submit"})})]}),a&&Object(m.jsx)("div",{className:"spinnerContainer",children:Object(m.jsx)("div",{className:"spinner"})}),Object(m.jsx)(b.Modal,{className:"msg",open:p,children:p})]})},S=function(e){var t=e.files,n=e.setFiles;return 0===t.length?null:Object(m.jsx)("div",{className:"preview",children:t.map((function(e){var t={type:e.type,name:e.name,url:URL.createObjectURL(e)},c=t.type.startsWith("image");return Object(m.jsxs)("div",{className:"file ".concat(c?"thumb":"any"),children:[Object(m.jsx)("button",{className:"close",type:"button",onClick:function(){return n((function(e){return e.filter((function(e){return t.name!==e.name}))}))},children:Object(m.jsx)(h.H,{})}),Object(m.jsx)(h.n,{className:c?"thumb":"",src:c?t.url:"/file_icon.png"}),!c&&Object(m.jsx)("p",{className:"filename",children:e.name})]},e.name)}))})};t.default=function(e){e.history,e.location;var t=e.match,n=Object(o.useContext)(d.d),c=n.user,s=(n.setUser,Object(o.useContext)(d.a)),a=s.contacts,i=s.setContacts,j=Object(o.useRef)(),u=Object(o.useState)(null),b=Object(l.a)(u,2),h=b[0],O=b[1],f=Object(o.useState)(null),x=Object(l.a)(f,2),k=x[0],C=x[1];return Object(o.useEffect)((function(){(null===h||void 0===h?void 0:h._id)!==j.current&&(d.e.emit("initiateChat",Object(r.a)({client_id:null===h||void 0===h?void 0:h._id},void 0===h.messages&&{newChat:!0})),j.current=h._id),h&&C(null===h||void 0===h?void 0:h.messages)}),[h]),Object(o.useEffect)((function(){if(t.params._id){var e=a.find((function(e){return e.client._id.toString()===t.params._id}));if(e){var n=e.client,c=e.messages,s=e.status;e.lastSeen;O(Object(r.a)(Object(r.a)({},n),{},{status:s,messages:c}))}}}),[t.params,a]),Object(m.jsxs)("div",{className:"chatContainer ".concat(h?"chatOpen":""),children:[Object(m.jsxs)("div",{className:"contactsContainer",children:[Object(m.jsx)(p,{setUserCard:O,setContacts:i}),Object(m.jsx)("p",{className:"label",children:"Messages"}),Object(m.jsx)("div",{className:"peopleWrapper",children:Object(m.jsxs)("ul",{className:"people",children:[a.map((function(e){var t=e.client,n=e.messages,c=e.status,s=e.lastSeen,a=e.unread;return Object(m.jsx)(g,{client:t,messages:n,status:c,lastSeen:s,userCard:h,unread:a},t._id)})),0===a.length&&Object(m.jsx)("p",{className:"placeholder",children:"Start making payments now."})]})})]}),Object(m.jsx)(v,{chat:k,setContacts:i,userCard:h,setUserCard:O,user:c,setChat:C})]})}},240:function(e,t,n){}}]);
//# sourceMappingURL=3.39732029.chunk.js.map