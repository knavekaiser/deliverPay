(this["webpackJsonpdeliveryPay-react"]=this["webpackJsonpdeliveryPay-react"]||[]).push([[15],{159:function(e,t,n){"use strict";n.r(t),n.d(t,"updateProfileInfo",(function(){return x}));var c=n(23),s=n.n(c),a=n(46),i=n(10),r=n(3),l=n(28),o=n(1),j=n(12),d=n(162),u=n(17),b=n(9),h=n(178),O=n.n(h),f=n(0);function x(e){return p.apply(this,arguments)}function p(){return(p=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/api/editUserProfile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(198);var m=function(e){var t=e.method,n=e.setMsg,c=Object(o.useContext)(j.d).setUser,s=Object(o.useState)(!1),a=Object(r.a)(s,2),l=a[0],h=a[1],O=Object(o.useCallback)((function(e){fetch("/api/deletePaymentMethod",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e._id})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?c((function(t){return Object(i.a)(Object(i.a)({},t),{},{paymentMethods:t.paymentMethods.filter((function(t){return t._id!==e._id}))})})):n(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return n(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Payment method could not be deleted."})]})]}))}))}),[]);return Object(f.jsxs)("li",{children:[Object(f.jsxs)("div",{className:"actions",children:[Object(f.jsx)("button",{className:"edit",onClick:function(){return h(t.__t)},children:"Edit"}),Object(f.jsx)("button",{className:"delete",onClick:function(){return Object(u.Confirm)({label:"Payment method delete",question:"Do you want to delete this payment method?",callback:function(){return O(t)}})},children:"Delete"})]}),"BankCard"===t.__t&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(d.BankCard,{card:t}),l===t.__t&&Object(f.jsx)(u.Modal,{open:l,head:!0,label:"Edit Payment Method",setOpen:h,className:"editPaymentMethod",children:Object(f.jsx)(d.BankCardForm,{prefill:t,onSuccess:function(e){e&&(h(!1),n(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return n(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.C,{}),Object(f.jsx)("h4",{children:"Payment method updated."})]})]})))}})})]}),"BankAccount"===t.__t&&Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(d.BankAccount,{account:t}),l===t.__t&&Object(f.jsx)(u.Modal,{open:l,head:!0,label:"Edit Payment Method",setOpen:h,className:"editPaymentMethod",children:Object(f.jsx)(d.NetBankingForm,{prefill:t,onSuccess:function(e){e&&(h(!1),n(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return n(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.C,{}),Object(f.jsx)("h4",{children:"Payment method updated."})]})]})))}})})]})]})},v=function(e){var t=e.label,n=e.fields,c=e.value,i=e.onError,d=e.setMsg,u=e.formData,h=Object(o.useContext)(j.d).setUser,O=Object(o.useState)(!1),x=Object(r.a)(O,2),p=x[0],m=x[1],v=Object(o.useRef)(null),g=function(){var e=Object(l.a)(s.a.mark((function e(t){var n,c,l,o,j,O;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),n={},c=Object(a.a)(new FormData(t.target).entries());try{for(c.s();!(l=c.n()).done;)o=Object(r.a)(l.value,2),j=o[0],O=o[1],n[j]=O}catch(s){c.e(s)}finally{c.f()}if(!n.password||n.password===n.confirm_password){e.next=7;break}return null===i||void 0===i||i(),e.abrupt("return");case 7:if(n["address.city"]&&navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,c=e.coords.longitude;n["address.location"]={type:"Point",coordinates:[c,t]}})),!n["kyc.files"]){e.next=15;break}return e.next=11,Object(b.F)({files:u,setMsg:d});case 11:if(e.t0=e.sent,e.t0){e.next=14;break}e.t0=[];case 14:n["kyc.files"]=e.t0;case 15:if(!n["gst.detail.files"]){e.next=22;break}return e.next=18,Object(b.F)({files:u,setMsg:d});case 18:if(e.t1=e.sent,e.t1){e.next=21;break}e.t1=[];case 21:n["gst.detail.files"]=e.t1;case 22:fetch("/api/editUserProfile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()})).then((function(e){var t=e.user;t?(h(t),m(!1)):alert("someting went wrong")})).catch((function(e){console.log(e),alert("someting went wrong")}));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(f.jsxs)("li",{children:[Object(f.jsx)("p",{className:"label",children:t}),Object(f.jsxs)("form",{ref:v,onSubmit:g,children:[p?Object(f.jsx)("div",{className:"inputs",children:n}):Object(f.jsx)("div",{className:"currentValue",children:c}),Object(f.jsx)("div",{className:"btns",children:p?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{type:"submit",children:"Save changes"},"submit"),Object(f.jsx)("button",{type:"button",onClick:function(){return m(!1)},children:"Cancel"},"cancel")]}):Object(f.jsx)("button",{type:"button",onClick:function(){return m(!0)},children:"Edit"},"edit")})]})]})};t.default=function(e){e.history,e.match,e.location;var t,n,c,s,l,d,h,p,g=Object(o.useContext)(j.d),k=g.user,y=g.setUser,C=Object(o.useState)(!1),N=Object(r.a)(C,2),M=N[0],S=N[1],F=Object(o.useState)(null),P=Object(r.a)(F,2),D=P[0],_=P[1],A=Object(o.useState)([]),w=Object(r.a)(A,2),T=w[0],I=w[1],Y=Object(o.useState)([]),E=Object(r.a)(Y,2),q=(E[0],E[1],function(e){e.googleId&&x({googleId:e.googleId}).then((function(t){y((function(t){return Object(i.a)(Object(i.a)({},t),{},{googleId:e.googleId})})),_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.C,{}),Object(f.jsx)("h4",{children:"Google account successfully connected."})]})]}))})).catch((function(e){console.log(e),_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Could not connect Google account."})]})]}))}))}),R=function(e){x({googleId:null}).then((function(e){e.user?(y((function(e){return Object(i.a)(Object(i.a)({},e),{},{googleId:null})})),_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.C,{}),Object(f.jsx)("h4",{children:"Successfully disconnected Google."})]})]}))):_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Could not disconnect Google account. Please try again."})]})]}))})).catch((function(e){console.log(e),_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Could not disconnect Google account."})]})]}))}))};return Object(f.jsxs)("div",{className:"profileContainer",children:[Object(f.jsxs)("div",{className:"benner",children:[Object(f.jsxs)("div",{className:"profileImg",children:[Object(f.jsx)(b.n,{src:k.profileImg||"/profile-user.jpg"}),Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"91.832",height:"25.468",viewBox:"0 0 91.832 25.468",children:Object(f.jsxs)("g",{id:"Path_1937","data-name":"Path 1937",transform:"translate(15.429 -9.647)",fill:"#fff",children:[Object(f.jsx)("path",{d:"M 29.79687690734863 34.6146240234375 C 22.21588897705078 34.6146240234375 13.43720626831055 32.0111198425293 5.0779709815979 27.28368377685547 C -2.8753981590271 22.78578186035156 -9.78753662109375 16.7585563659668 -14.48426628112793 10.24203777313232 C -13.95890235900879 10.24473857879639 -13.30369663238525 10.25548648834229 -12.80753517150879 10.26361274719238 C -12.44524097442627 10.26955413818359 -12.15906429290771 10.27424812316895 -12.02891159057617 10.27424812316895 C -11.93940830230713 10.27424812316895 -11.86373233795166 10.26253128051758 -11.79978466033936 10.24241733551025 C -11.48864650726318 10.21196746826172 -10.04010391235352 10.17821311950684 -5.149840831756592 10.17821311950684 C -1.226676225662231 10.17821311950684 4.093100070953369 10.19837760925293 9.725229263305664 10.21973037719727 C 16.20444107055664 10.24428367614746 23.54814720153809 10.27211856842041 29.79687690734863 10.27211856842041 C 31.89767646789551 10.27211856842041 43.68988800048828 10.22107124328613 56.17448806762695 10.16702461242676 L 59.24650192260742 10.15374183654785 C 60.32665252685547 10.14907169342041 61.61424255371094 10.14680099487305 63.18285369873047 10.14680099487305 C 64.99295043945313 10.14680099487305 66.92156219482422 10.14978885650635 68.78666687011719 10.15269470214844 C 70.55825042724609 10.1554479598999 72.23158264160156 10.15804767608643 73.72422027587891 10.15804767608643 C 74.4501953125 10.15804767608643 75.08247375488281 10.1574182510376 75.63590240478516 10.15613842010498 C 74.24596405029297 13.15391826629639 71.95748138427734 16.1362361907959 68.82386779785156 19.03109550476074 C 65.67525482177734 21.9398250579834 61.6738166809082 24.71903610229492 57.25215911865234 27.06828308105469 C 52.91740798950195 29.37135314941406 48.15610122680664 31.27616500854492 43.48295974731445 32.57678985595703 C 38.69290161132813 33.90995407104492 33.96032333374023 34.6146240234375 29.79687690734863 34.6146240234375 Z",stroke:"none"}),Object(f.jsx)("path",{d:"M 63.18235397338867 10.64679336547852 C 61.61428070068359 10.64679336547852 60.32755279541016 10.64906692504883 59.24865341186523 10.65373229980469 L 56.18099212646484 10.6670036315918 C 43.69374084472656 10.72105407714844 31.89901733398438 10.77211761474609 29.79687881469727 10.77211761474609 C 23.54719161987305 10.77211761474609 16.2029914855957 10.74428176879883 9.723331451416016 10.71971893310547 C 4.091693878173828 10.69837951660156 -1.227619171142578 10.67821884155273 -5.149848937988281 10.67821884155273 C -9.844169616699219 10.67821884155273 -11.33226013183594 10.70873641967773 -11.7083740234375 10.73677062988281 C -11.80277252197266 10.76053237915039 -11.90915679931641 10.77424240112305 -12.0289306640625 10.77424240112305 C -12.16323089599609 10.77424240112305 -12.45131683349609 10.7695198059082 -12.81605529785156 10.76354217529297 C -13.01943206787109 10.76021194458008 -13.24966430664063 10.75643920898438 -13.48653411865234 10.75296401977539 C -8.851593017578125 16.903076171875 -2.239547729492188 22.57095718383789 5.324104309082031 26.84845542907715 C 13.60947799682617 31.53411865234375 22.30074310302734 34.11461639404297 29.79687881469727 34.11461639404297 C 33.91565704345703 34.11461639404297 38.60186767578125 33.41628265380859 43.34890747070313 32.0950927734375 C 47.98773193359375 30.80401802062988 52.71426773071289 28.91309356689453 57.0175666809082 26.62672996520996 C 61.40182876586914 24.29735565185547 65.3670654296875 21.5438175201416 68.48458099365234 18.6638298034668 C 71.32099151611328 16.04351997375488 73.45128631591797 13.35661125183105 74.83492279052734 10.65748596191406 C 74.4908447265625 10.65786743164063 74.12125396728516 10.65805435180664 73.72370147705078 10.65805435180664 C 72.23068237304688 10.65805435180664 70.55716705322266 10.65545654296875 68.78539276123047 10.65269470214844 C 66.92047119140625 10.6497917175293 64.9920654296875 10.64679336547852 63.18235397338867 10.64679336547852 M 63.18235778808594 9.646797180175781 C 66.69034576416016 9.646797180175781 70.639892578125 9.658050537109375 73.72370910644531 9.658050537109375 C 74.72272491455078 9.658050537109375 75.63052368164063 9.656867980957031 76.4033203125 9.653743743896484 C 70.7041015625 23.3221435546875 47.19384002685547 35.11461639404297 29.79687881469727 35.11461639404297 C 13.80905532836914 35.11461639404297 -5.7138671875 23.84020614624023 -15.427734375 9.772117614746094 C -15.45098876953125 9.749141693115234 -15.14891815185547 9.741405487060547 -14.71451568603516 9.741401672363281 C -13.8193359375 9.741401672363281 -12.36181640625 9.774246215820313 -12.02893829345703 9.774246215820313 C -11.98212432861328 9.774246215820313 -11.95759582519531 9.773597717285156 -11.9599609375 9.772117614746094 C -12.07225799560547 9.701694488525391 -9.402595520019531 9.678211212158203 -5.14984130859375 9.678211212158203 C 3.356430053710938 9.678211212158203 18.19854354858398 9.772117614746094 29.79687881469727 9.772117614746094 C 32.07231903076172 9.772117614746094 46.01445388793945 9.710941314697266 59.24433135986328 9.653743743896484 C 60.42824935913086 9.648624420166016 61.76977157592773 9.646797180175781 63.18235778808594 9.646797180175781 Z",stroke:"none",fill:"#336cf9"})]})}),Object(f.jsx)("input",{type:"file",accept:".jpg, .png, .jpeg",onChange:function(e){var t=e.target.files[0],n="https://cdn.deliverypay.in";if(t){var c,s=new FormData,r=Object(a.a)(e.target.files);try{for(r.s();!(c=r.n()).done;){var l=c.value;s.append("file",l)}}catch(o){r.e(o)}finally{r.f()}fetch("".concat(n,"/upload"),{method:"POST",body:s}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?x({profileImg:n+"/"+e.files[0]}).then((function(e){e.user&&y((function(t){return Object(i.a)(Object(i.a)({},t),{},{profileImg:e.user.profileImg})}))})):_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Image upload failed"})]})]}))})).catch((function(e){_(Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(f.jsxs)("div",{children:[Object(f.jsx)(b.i,{}),Object(f.jsx)("h4",{children:"Image upload failed. Make sure you're online."})]})]}))}))}}}),Object(f.jsx)("label",{children:"Edit"})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("p",{className:"name",children:k.firstName+" "+k.lastName}),Object(f.jsxs)("p",{className:"id",children:["Delivery pay ID: ",k.userId||k._id]})]})]}),Object(f.jsxs)("div",{className:"settings",children:[Object(f.jsx)("div",{className:"head",children:"Account Settings"}),Object(f.jsxs)("ul",{children:[Object(f.jsx)(v,{label:"Name",fields:Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"First name",defaultValue:k.firstName,name:"firstName",required:!0})}),Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"last name",defaultValue:k.lastName,name:"lastName",required:!0})})]}),value:k.firstName+" "+k.lastName}),Object(f.jsx)(v,{label:"Phone Number",fields:Object(f.jsx)(f.Fragment,{children:Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"Phone Number",defaultValue:k.phone,name:"phone",required:!0,pattern:"^(\\+91|91|1|)\\d{10}$"})})}),value:k.phone}),Object(f.jsx)(v,{label:"Email",fields:Object(f.jsx)(f.Fragment,{children:Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"email",placeholder:"Phone Number",defaultValue:k.email,name:"email",required:!0})})}),value:k.email}),Object(f.jsx)(v,{label:"Password",onError:function(){return S(!0)},fields:Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"Password",name:"password",required:!0,type:"password",onChange:function(e){return S(!1)}})}),Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"Confirm password",name:"confirm_password",required:!0,type:"password",onChange:function(e){return S(!1)}})}),M&&Object(f.jsx)("p",{className:"errMsg",children:"Password did not match."})]}),value:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"}),Object(f.jsx)(v,{label:"Gender",fields:Object(f.jsx)(f.Fragment,{children:Object(f.jsx)("section",{children:Object(f.jsx)("input",{placeholder:"Gender",defaultValue:k.gender,name:"gender",required:!0})})}),value:k.gender}),Object(f.jsx)(v,{label:"Age",fields:Object(f.jsx)(f.Fragment,{children:Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"number",placeholder:"Age",defaultValue:k.age,name:"age",required:!0})})}),value:k.age}),Object(f.jsx)(v,{label:"Address",fields:Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"text",placeholder:"Address",defaultValue:k.address.street,name:"address.street",required:!0})}),Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"text",placeholder:"City",defaultValue:k.address.city,name:"address.city",required:!0})}),Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"text",placeholder:"State",defaultValue:k.address.state,name:"address.state",required:!0})}),Object(f.jsx)("section",{children:Object(f.jsx)("input",{type:"number",placeholder:"PIN Code",defaultValue:k.address.zip,name:"address.zip",required:!0})})]}),value:"".concat((null===(t=k.address)||void 0===t?void 0:t.street)||""," ").concat((null===(n=k.address)||void 0===n?void 0:n.city)||""," ").concat((null===(c=k.address)||void 0===c?void 0:c.state)||""," ").concat((null===(s=k.address)||void 0===s?void 0:s.zip)||"")})]})]}),Object(f.jsxs)("div",{className:"kyc",children:[Object(f.jsx)("div",{className:"head",children:"KYC"}),Object(f.jsx)("ul",{children:Object(f.jsx)(v,{label:"KYC",setMsg:_,formData:T,fields:Object(f.jsx)(f.Fragment,{children:Object(f.jsxs)("section",{children:[Object(f.jsx)("label",{children:"Upload files for verification."}),Object(f.jsx)(b.k,{multiple:!0,prefill:null===(l=k.kyc)||void 0===l?void 0:l.files,name:"kyc.files",onChange:function(e){return I(e)}})]})}),value:Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("p",{children:["Status: ",(null===(d=k.kyc)||void 0===d?void 0:d.verified)?"Verified":"Unverified"]}),Object(f.jsx)("label",{children:"Files for verification:"}),Object(f.jsx)("ul",{className:"thumbs",children:Object(f.jsx)(b.q,{links:null===(h=k.kyc)||void 0===h?void 0:h.files})})]})})})]}),Object(f.jsxs)("div",{className:"paymentMethods",children:[Object(f.jsx)("div",{className:"head",children:"Payment Methods"}),Object(f.jsxs)("ul",{className:"methods",children:[k.paymentMethods.map((function(e,t){return Object(f.jsx)(m,{setMsg:_,method:e},t)})),0===(null===(p=k.paymentMethods)||void 0===p?void 0:p.length)&&Object(f.jsx)("p",{children:"No payment method added."})]})]}),Object(f.jsxs)("div",{className:"socials",children:[Object(f.jsx)("div",{className:"head",children:"Connect Social Accounts"}),Object(f.jsx)("ul",{className:"providers",children:k.googleId?Object(f.jsx)(O.a,{className:"google",clientId:"978249749020-kjq65au1n373ur5oap7n4ebo2fq1jdhq.apps.googleusercontent.com",buttonText:"Disconnect from Google",onSuccess:R,onFailure:R,cookiePolicy:"single_host_origin"}):Object(f.jsx)(O.a,{className:"google",clientId:"978249749020-kjq65au1n373ur5oap7n4ebo2fq1jdhq.apps.googleusercontent.com",buttonText:"Connect with Google",onSuccess:q,onFailure:q,cookiePolicy:"single_host_origin"})})]}),Object(f.jsx)(u.Modal,{className:"msg",open:D,children:D})]})}},170:function(e,t,n){"use strict";n.r(t);var c=n(13),s=n(10),a=n(3),i=n(23),r=n.n(i),l=n(28),o=n(1),j=n(12),d=n(9),u=n(17),b=n(4),h=n(2),O=n(175),f=n(163),x=n(0),p=Object(o.lazy)((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,158)).then((function(e){return{default:e.MilestoneForm}}))})),m=function(e){var t,n=e.refund,s=(e.setRefunds,e.selectAll),i=e.setBatch,r=(e.batch,Object(b.g)()),l=(Object(o.useContext)(j.d).user,Object(o.useState)(s||!1)),h=Object(a.a)(l,2),O=h[0],f=h[1],p=Object(o.useState)(!1),m=Object(a.a)(p,2),v=(m[0],m[1],Object(o.useState)(!1)),g=Object(a.a)(v,2),k=g[0];g[1];return Object(o.useEffect)((function(){f(s)}),[s]),Object(o.useEffect)((function(){i(O?function(e){return[].concat(Object(c.a)(e),[n._id])}:function(e){return e.filter((function(e){return e!==n._id}))})}),[O]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("tr",{className:"refund ".concat(O?"selected":""),onClick:function(){return r.push("/account/myShop/refunds/".concat(n._id))},children:[Object(x.jsx)("td",{className:"date",children:Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mm a",children:n.createdAt})}),Object(x.jsx)("td",{children:Object(x.jsx)(d.G,{user:n.seller})}),Object(x.jsx)("td",{children:null===(t=n.order)||void 0===t?void 0:t.products.reduce((function(e,t){return e+t.qty}),0)}),Object(x.jsx)("td",{children:n.status}),Object(x.jsxs)("td",{children:["\u20b9",n.order.total]})]}),Object(x.jsx)(u.Modal,{className:"msg",open:k,children:k})]})},v=function(e){var t,n,i,b=e.history,O=e.match,f=Object(o.useContext)(j.d).userType,m=Object(o.useState)(null),v=Object(a.a)(m,2),g=v[0],k=v[1],y=Object(o.useState)(null),C=Object(a.a)(y,2),N=C[0],M=C[1],S=Object(o.useState)(null),F=Object(a.a)(S,2),P=F[0],D=F[1],_=Object(o.useState)(!1),A=Object(a.a)(_,2),w=A[0],T=A[1],I=Object(o.useState)(!1),Y=Object(a.a)(I,2),E=Y[0],q=Y[1],R=(Object(o.useRef)(),function(){var e=Object(l.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/api/updateRefund",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(s.a)(Object(s.a)({},t),{},{_id:N._id}))}).then((function(e){return e.json()})).then((function(e){if("ok"===e.code)return e.order;k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Refund request does not exist."})]})]}))})).catch((function(e){console.log(e),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not update refund. Make sure you're online."})]})]}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),B=function(){var e=Object(l.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/api/acceptRefund",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:N._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(M((function(e){return Object(s.a)(Object(s.a)({},e),{},{status:"approved"})})),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Refund request has been approved."})]})]}))):k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Refund request does not exist."})]})]}))})).catch((function(e){console.log(e),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not accept refund request. Make sure you're online."})]})]}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(l.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/api/declineRefund",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:N._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(M((function(e){return Object(s.a)(Object(s.a)({},e),{},{status:"declined"})})),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Refund request has been declined."})]})]}))):k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Refund request does not exist."})]})]}))})).catch((function(e){console.log(e),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not decline refund request. Make sure you're online."})]})]}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(o.useEffect)((function(){fetch("/api/singleRefund?_id=".concat(O.params._id)).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(D(e.refund.order),M(e.refund)):k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Refund does not exist."})]})]}))})).catch((function(e){console.log(e),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not get Refund. Make sure you're online."})]})]}))}))}),[]),Object(o.useEffect)((function(){if(null===P||void 0===P?void 0:P.refundable){var e=0;switch(P.refundable){case"Upto 24 Hours After Delivery":e=1;break;case"Upto 7 Days After Delivery":e=7;break;case"Upto 15 Days After Delivery":e=15;break;default:return}var t=new Date((new Date).getTime()+864e5*e);new Date<t?q(t):q(null)}else q(null)}),[N]),N?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{className:"actions",children:[Object(x.jsxs)(h.b,{to:"/account/".concat("seller"===f?"myShop":"myShopping","/refunds"),className:"back",children:[Object(x.jsx)(d.c,{}),"Back"]}),"productSent"===N.status&&Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Refund Resolved",question:"You sure want to mark this refund resolved?",callback:function(){R({status:"productRecieved"}).then((function(e){M((function(e){return Object(s.a)(Object(s.a)({},e),{},{status:"productRecieved"})}))}))}})},children:"Mark as Recieved"}),"pending"===N.status&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Accepting Refund",question:"Do you accept this refund request?",callback:B})},children:"Accept"}),Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Declining Refund",question:"Do you decline this refund?",callback:U})},children:"Decline"})]})]}),Object(x.jsxs)("div",{className:"singleOrder",children:[Object(x.jsxs)("div",{className:"summery",children:[Object(x.jsx)("h3",{children:"Summery"}),Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{className:"devide",children:[Object(x.jsx)("label",{children:"Order"}),Object(x.jsx)("span",{})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Seller"}),Object(x.jsx)(d.G,{user:P.seller})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Order ID"}),P._id]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Status"}),P.status]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Ordered at"}),Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mma",children:P.createdAt})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Delivered at"}),Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mm a",children:P.deliveredAt})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Refundable"}),P.refundable||"N/A"]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Proof of delivery"}),(null===(t=P.files)||void 0===t?void 0:t.length)>0?Object(x.jsx)("div",{className:"thumbs",children:Object(x.jsx)(d.q,{links:P.files})}):Object(x.jsx)(x.Fragment,{children:"No files added."})]}),E&&Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Refund till"}),Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mm a",children:E})]}),Object(x.jsx)("li",{}),Object(x.jsxs)("li",{className:"devide",children:[Object(x.jsx)("label",{children:"Refund"}),Object(x.jsx)("span",{})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Refund ID"}),N._id]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Status"}),N.status]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Submitted at"}),Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mma",children:N.createdAt})]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Issue"}),N.issue]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Descrption"}),N.dscr]}),Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Images"}),Object(x.jsx)("div",{className:"thumbs",children:N.files.length?Object(x.jsx)(d.q,{links:N.files}):Object(x.jsx)(x.Fragment,{children:"No Images has been provided."})})]}),Object(x.jsx)("li",{}),Object(x.jsxs)("li",{className:"devide",children:[Object(x.jsx)("label",{children:"Delivery Address"}),Object(x.jsx)("span",{})]}),Object(x.jsx)(x.Fragment,{children:Object.entries(P.deliveryDetail).map((function(e,t){var n=Object(a.a)(e,2),c=n[0],s=n[1];return"deliveryTime"===c?Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:"Delivery date"}),P.deliveryDetail.deliveryTime?Object(x.jsx)(d.s,{format:"DD MMM, YYYY hh:mma",children:P.deliveryDetail.deliveryTime}):"N/A"]},t):Object(x.jsxs)("li",{children:[Object(x.jsx)("label",{children:c}),s]},t)}))})]})]}),Object(x.jsxs)("div",{className:"products",children:[Object(x.jsx)("h3",{children:"Products"}),Object(x.jsx)("ul",{children:P.products.map((function(e,t){var n=e.product,c=e.qty;return Object(x.jsxs)("li",{children:[Object(x.jsx)(d.n,{src:n.images[0]||"/open_box.png"}),Object(x.jsxs)("div",{className:"detail",children:[Object(x.jsx)("p",{children:n.name}),Object(x.jsxs)("p",{className:"qty",children:["QTY: ",c]})]}),Object(x.jsxs)("div",{className:"price",children:[Object(x.jsxs)("span",{children:[Object(d.K)({product:n,gst:!0})," x ",c]}),"\u20b9",Object(d.K)({product:n,gst:!0})*c]})]},t)}))}),Object(x.jsxs)("div",{className:"total",children:[Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("label",{children:"Total"}),"\u20b9",P.products.reduce((function(e,t){return e+Object(d.K)({product:t.product,gst:!0})*t.qty}),0)]}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("label",{children:"Shipping"}),P.shipping||"N/A"]}),Object(x.jsxs)("div",{className:"data",children:[Object(x.jsx)("label",{children:"Grand Total"}),"\u20b9",P.products.reduce((function(e,t){return e+Object(d.K)({product:t.product,gst:!0})*t.qty}),0)+(+P.shipping||0)]})]})]}),Object(x.jsxs)("div",{className:"milestones",children:[Object(x.jsxs)("h3",{children:["Milestones",("approved"===N.status||"productSent"===N.status||"productRecieved"===N.status)&&Object(x.jsx)("button",{onClick:function(){return T(!0)},children:"Create Milestone"})]}),"pending"===N.status&&Object(x.jsx)("p",{children:"You can create milestones once you accept the refund request."}),"declined"===N.status&&Object(x.jsx)("p",{children:"This refund request has been declined."}),!("declined"===N.status||"pending"===N.status)&&Object(x.jsxs)("table",{cellSpacing:0,cellPadding:0,children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:"Date"}),Object(x.jsx)("td",{children:"Descrption"}),Object(x.jsx)("td",{children:"Amount"}),Object(x.jsx)("td",{children:"Status"})]})}),Object(x.jsxs)("tbody",{children:[N.milestones.map((function(e){return Object(x.jsxs)("tr",{onClick:function(){return b.push("/account/hold?q=".concat(e._id))},children:[Object(x.jsx)("td",{children:Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mma",children:e.createdAt})}),Object(x.jsx)("td",{children:e.dscr}),Object(x.jsxs)("td",{children:["\u20b9",e.amount]}),Object(x.jsx)("td",{children:e.status})]},e._id)})),0===N.milestones.length&&Object(x.jsx)("tr",{className:"placeholdert",children:Object(x.jsx)("td",{children:"Nothing yet."})})]})]})]}),Object(x.jsxs)("section",{className:"terms",children:[Object(x.jsx)("h3",{children:"Return Policy Terms"}),Object(x.jsxs)("ul",{children:[null===(n=P.terms)||void 0===n?void 0:n.map((function(e,t){return Object(x.jsx)("li",{children:e},t)})),!(null===(i=P.terms)||void 0===i?void 0:i.length)&&Object(x.jsx)("li",{children:"No terms has been set by the seller yet."})]})]})]}),Object(x.jsx)(u.Modal,{head:!0,label:"Create Milestone",setOpen:T,className:"milestoneRequest",open:w,children:Object(x.jsx)(p,{action:"create",definedAmount:P.total,client:N.seller,refund:N._id,onSuccess:function(e){T(!1),k(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return k(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsxs)("h4",{className:"amount",children:["\u20b9",null===e||void 0===e?void 0:e.amount]}),Object(x.jsx)("h4",{children:"Milestone has been created"})]}),Object(x.jsx)(h.b,{to:"/account/hold",onClick:function(){return k(null)},children:"Check your Delivery pay Hold"})]})),M((function(t){return Object(s.a)(Object(s.a)({},t),{},{milestones:[].concat(Object(c.a)(t.milestones),[e])})}))}})}),Object(x.jsx)(u.Modal,{className:"msg",open:g,children:g})]}):Object(x.jsx)(x.Fragment,{children:"Loading"})},g=function(e){e.history,e.location;var t=Object(o.useContext)(j.d).userType,n=Object(o.useState)(0),c=Object(a.a)(n,2),i=c[0],r=c[1],l=Object(o.useState)(1),b=Object(a.a)(l,2),h=b[0],O=b[1],f=Object(o.useState)(20),p=Object(a.a)(f,2),v=p[0],g=p[1],k=Object(o.useState)(""),y=Object(a.a)(k,2),C=y[0],N=y[1],M=Object(o.useState)(""),S=Object(a.a)(M,2),F=S[0],P=S[1],D=Object(o.useState)({column:"createdAt",order:"dsc"}),_=Object(a.a)(D,2),A=_[0],w=(_[1],Object(o.useState)({startDate:new Date,endDate:new Date})),T=Object(a.a)(w,2),I=T[0],Y=T[1],E=Object(o.useState)([]),q=Object(a.a)(E,2),R=q[0],B=q[1],U=Object(o.useState)(!1),V=Object(a.a)(U,2),G=V[0],L=V[1],H=Object(o.useState)([]),J=Object(a.a)(H,2),W=J[0],K=J[1],z=Object(o.useState)(null),Z=Object(a.a)(z,2),Q=Z[0],$=Z[1];return Object(o.useEffect)((function(){var e,n=Object(d.L)({time:null===I||void 0===I?void 0:I.startDate,format:"YYYY-MM-DD"}),c=Object(d.L)({time:null===(e=new Date(null===I||void 0===I?void 0:I.endDate))||void 0===e?void 0:e.setHours(24,0,0,0),format:"YYYY-MM-DD"});fetch("/api/getRefunds?".concat(new URLSearchParams(Object(s.a)(Object(s.a)(Object(s.a)({user:t},C&&{q:C}),{},{page:h,perPage:v,sort:A.column,order:A.order},I&&{dateFrom:n,dateTo:c}),F&&{status:F})))).then((function(e){return e.json()})).then((function(e){"ok"===e.code&&(B(e.refunds),r(e.total))})).catch((function(e){console.log(e),$(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return $(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not get orders."})]})]}))}))}),[C,h,v,I,F]),Object(o.useEffect)((function(){G||K([])}),[G]),Object(o.useEffect)((function(){0===W.length&&L(!1)}),[W]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"benner",children:Object(x.jsx)("p",{children:"My Refunds"})}),Object(x.jsxs)("div",{className:"filters",children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Total:"}),i]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Per Page:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"20",value:20},{label:"30",value:30},{label:"50",value:50}],onChange:function(e){return g(e.value)}})]}),Object(x.jsxs)("section",{className:"search",children:[Object(x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"23",height:"23",viewBox:"0 0 23 23",children:Object(x.jsx)("path",{id:"Icon_ionic-ios-search","data-name":"Icon ionic-ios-search",d:"M27.23,25.828l-6.4-6.455a9.116,9.116,0,1,0-1.384,1.4L25.8,27.188a.985.985,0,0,0,1.39.036A.99.99,0,0,0,27.23,25.828ZM13.67,20.852a7.2,7.2,0,1,1,5.091-2.108A7.155,7.155,0,0,1,13.67,20.852Z",transform:"translate(-4.5 -4.493)",fill:"#707070",opacity:"0.74"})}),Object(x.jsx)("input",{value:C,onChange:function(e){return N(e.target.value)},placeholder:"Search for Customer"}),C&&Object(x.jsx)("button",{onClick:function(){return N("")},children:Object(x.jsx)(d.H,{})})]}),Object(x.jsxs)("section",{className:"category",children:[Object(x.jsx)("label",{children:"Status:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"All",value:""},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Product Sent",value:"productSent"},{label:"Product Recieved",value:"productRecieved"},{label:"Resolved",value:"resolved"}],onChange:function(e){return P(e.value)}})]}),Object(x.jsx)("section",{className:"date",children:Object(x.jsx)(d.o,{dateRange:I,onChange:function(e){return Y(e)}})})]}),W.length>0&&Object(x.jsx)("div",{className:"batchAction",children:Object(x.jsx)("button",{onClick:function(){return console.log("batch delete")},children:"Delete"})}),Object(x.jsxs)("table",{className:"table refunds",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"date",children:"Date"}),Object(x.jsx)("th",{children:"Customer"}),Object(x.jsx)("th",{children:"QTY"}),Object(x.jsx)("th",{children:"Status"}),Object(x.jsx)("th",{children:"Total Price"})]})}),Object(x.jsxs)("tbody",{children:[R.map((function(e){return Object(x.jsx)(m,{refund:e,setRefunds:B,selectAll:G,setBatch:K,batch:W},e._id)})),0===R.length&&Object(x.jsx)("tr",{className:"placeholder",children:Object(x.jsx)("td",{children:"No product yet."})})]})]}),Object(x.jsx)(d.u,{total:i,btns:5,currentPage:h,perPage:v,setPage:O}),Object(x.jsx)(u.Modal,{className:"msg",open:Q,children:Q})]})},k=(n(44),function(e){var t,n,i,r,l,h=e.coupon,O=e.setCoupons,f=e.selectAll,p=e.setBatch,m=e.batch,v=Object(o.useRef)(),g=Object(o.useRef)(),k=(Object(b.g)(),Object(o.useContext)(j.d).user,Object(o.useState)(f||!1)),y=Object(a.a)(k,2),C=y[0],N=y[1],M=Object(o.useState)(!1),S=Object(a.a)(M,2),F=(S[0],S[1],Object(o.useState)(!1)),P=Object(a.a)(F,2),D=P[0],_=P[1],A=Object(o.useState)(!1),w=Object(a.a)(A,2),T=w[0],I=w[1];return Object(o.useEffect)((function(){N(f)}),[f]),Object(o.useEffect)((function(){p(C?function(e){return[].concat(Object(c.a)(e),[h._id])}:function(e){return e.filter((function(e){return e!==h._id}))})}),[C]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("tr",{className:"coupon ".concat(C?"selected":""),onClick:function(e){e.nativeEvent.path.includes(v.current)||e.nativeEvent.path.includes(g.current)||m.length>0||I(!0)},children:[Object(x.jsx)("td",{className:"date",children:Object(x.jsx)(d.s,{format:"DD MMM YY",children:h.createdAt})}),Object(x.jsx)("td",{children:h.title}),Object(x.jsx)("td",{children:h.status}),Object(x.jsx)("td",{children:h.code}),Object(x.jsx)("td",{className:"discount",children:"percent"===h.type?Object(x.jsxs)(x.Fragment,{children:[h.amount,"%",Object(x.jsxs)("span",{children:["Up to \u20b9",h.maxDiscount]})]}):Object(x.jsxs)(x.Fragment,{children:["\u20b9",h.amount]})}),Object(x.jsxs)("td",{children:["\u20b9",h.threshold]}),Object(x.jsxs)("td",{children:[Object(x.jsx)(d.s,{format:"DD MMM YY",children:null===(t=h.date)||void 0===t?void 0:t.from}),"-",Object(x.jsx)(d.s,{format:"DD MMM YY",children:null===(n=h.date)||void 0===n?void 0:n.to})]}),Object(x.jsx)("td",{children:h.accept?"Yes":"No"}),Object(x.jsx)("td",{ref:v,children:0===m.length&&Object(x.jsxs)(d.a,{icon:Object(x.jsx)(d.g,{}),children:[Object(x.jsx)("button",{onClick:function(){return I(h)},children:"View Detail"}),h.accept&&Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Accepting Coupon code",question:"You sure want to take part in this campaign and accept this coupon code?",callback:function(){return e=h._id,void fetch("/api/declineCoupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?(O((function(t){return t.map((function(t){return t._id===e?Object(s.a)(Object(s.a)({},t),{},{accept:!1}):t}))})),_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Coupon code declined. Buyers can no longer apply this coupon code on your shop."})]})]}))):_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not decline Coupon code. please try again."})]})]}))})).catch((function(e){console.log(e),_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not decline Coupon code. Make sure you're online."})]})]}))}));var e}})},children:"Decline"}),new Date(null===(i=h.date)||void 0===i?void 0:i.to)>=new Date(Object(d.L)({time:new Date,format:"YYYY-MM-DD"}))&&!h.accept&&Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Accepting Coupon code",question:"You sure want to take part in this campaign and accept this coupon code?",callback:function(){return e=h._id,void fetch("/api/acceptCoupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?(O((function(t){return t.map((function(t){return t._id===e?Object(s.a)(Object(s.a)({},t),{},{accept:!0}):t}))})),_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Coupon code accepted. Now Buyers can apply this coupon code on your shop."})]})]}))):_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not accept Coupon code. please try again."})]})]}))})).catch((function(e){console.log(e),_(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return _(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not accept Coupon code. Make sure you're online."})]})]}))}));var e}})},children:"Accept"})]})})]}),Object(x.jsx)(u.Modal,{className:"msg",open:D,children:D}),Object(x.jsx)(u.Modal,{open:T,head:!0,label:"Coupon Detail",setOpen:I,className:"couponDetail",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Campaign Title"}),Object(x.jsx)("p",{children:null===T||void 0===T?void 0:T.title})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Campaign Description"}),Object(x.jsx)("p",{children:null===T||void 0===T?void 0:T.dscr})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Coupon Code"}),Object(x.jsx)("p",{children:null===T||void 0===T?void 0:T.code})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Coupon code status"}),Object(x.jsx)("p",{children:null===T||void 0===T?void 0:T.status})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Discount"}),Object(x.jsx)("p",{children:"percent"===(null===T||void 0===T?void 0:T.type)?Object(x.jsxs)(x.Fragment,{children:[null===T||void 0===T?void 0:T.amount,"% up to \u20b9",T.maxDiscount]}):Object(x.jsxs)(x.Fragment,{children:["\u20b9",null===T||void 0===T?void 0:T.amount]})})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Validity"}),Object(x.jsxs)("p",{children:[Object(x.jsx)(d.s,{format:"DD MMM YY",children:null===(r=T.date)||void 0===r?void 0:r.from}),"-",Object(x.jsx)(d.s,{format:"DD MMM YY",children:null===(l=T.date)||void 0===l?void 0:l.to})]})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Accept"}),Object(x.jsx)("p",{children:T.accept?"Yes":"No"})]})]})})]})}),y=function(e){e.categories;var t=Object(o.useState)(0),n=Object(a.a)(t,2),c=n[0],i=n[1],r=Object(o.useState)(1),l=Object(a.a)(r,2),j=l[0],b=l[1],h=Object(o.useState)(20),O=Object(a.a)(h,2),f=O[0],p=O[1],m=Object(o.useState)(""),v=Object(a.a)(m,2),g=v[0],y=v[1],C=Object(o.useState)(""),N=Object(a.a)(C,2),M=N[0],S=N[1],F=Object(o.useState)({column:"createdAt",coupon:"dsc"}),P=Object(a.a)(F,2),D=P[0],_=(P[1],Object(o.useState)([])),A=Object(a.a)(_,2),w=A[0],T=A[1],I=Object(o.useState)(!1),Y=Object(a.a)(I,2),E=Y[0],q=Y[1],R=Object(o.useState)([]),B=Object(a.a)(R,2),U=B[0],V=B[1],G=Object(o.useState)(null),L=Object(a.a)(G,2),H=L[0],J=L[1];return Object(o.useEffect)((function(){fetch("/api/getCoupons?".concat(new URLSearchParams(Object(s.a)(Object(s.a)({},M&&{q:M}),{},{page:j,perPage:f,sort:D.column,order:D.order},g&&{status:g})))).then((function(e){return e.json()})).then((function(e){"ok"===e.code&&(T(e.coupons),i(e.total))})).catch((function(e){console.log(e),J(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return J(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not get coupons."})]})]}))}))}),[g,M,j,f]),Object(o.useEffect)((function(){E||V([])}),[E]),Object(o.useEffect)((function(){0===U.length&&q(!1)}),[U]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("div",{className:"benner",children:Object(x.jsx)("p",{children:"Order Management"})}),Object(x.jsxs)("div",{className:"filters",children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Total:"}),c]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Per Page:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"20",value:20},{label:"30",value:30},{label:"50",value:50}],onChange:function(e){return p(e.value)}})]}),Object(x.jsxs)("section",{className:"search",children:[Object(x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"23",height:"23",viewBox:"0 0 23 23",children:Object(x.jsx)("path",{id:"Icon_ionic-ios-search","data-name":"Icon ionic-ios-search",d:"M27.23,25.828l-6.4-6.455a9.116,9.116,0,1,0-1.384,1.4L25.8,27.188a.985.985,0,0,0,1.39.036A.99.99,0,0,0,27.23,25.828ZM13.67,20.852a7.2,7.2,0,1,1,5.091-2.108A7.155,7.155,0,0,1,13.67,20.852Z",transform:"translate(-4.5 -4.493)",fill:"#707070",opacity:"0.74"})}),Object(x.jsx)("input",{value:M,onChange:function(e){return S(e.target.value)},placeholder:"Search for Buyer"}),M&&Object(x.jsx)("button",{onClick:function(){return S("")},children:Object(x.jsx)(d.H,{})})]}),Object(x.jsxs)("section",{className:"category",children:[Object(x.jsx)("label",{children:"Status:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"All",value:""},{label:"Pending",value:"draft"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],onChange:function(e){return y(e.value)}})]})]}),U.length>0&&Object(x.jsx)("div",{className:"batchAction",children:Object(x.jsx)("button",{onClick:function(){return console.log("batch delete")},children:"Delete"})}),Object(x.jsxs)("table",{className:"table coupons",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"date",children:"Date"}),Object(x.jsx)("th",{children:"Title"}),Object(x.jsx)("th",{children:"Status"}),Object(x.jsx)("th",{children:"Code"}),Object(x.jsx)("th",{children:"Discount"}),Object(x.jsx)("th",{children:"Threshold"}),Object(x.jsx)("th",{children:"Validity"}),Object(x.jsx)("th",{children:"Accept"}),Object(x.jsx)("th",{children:"Actions"})]})}),Object(x.jsxs)("tbody",{children:[w.map((function(e,t){return Object(x.jsx)(k,{coupon:e,setCoupons:T,selectAll:E,setBatch:V,batch:U},t)})),0===w.length&&Object(x.jsx)("tr",{className:"placeholder",children:Object(x.jsx)("td",{children:"No product yet."})})]})]}),Object(x.jsx)(d.u,{total:c,btns:5,currentPage:j,perPage:f,setPage:b}),Object(x.jsx)(u.Modal,{className:"msg",open:H,children:H})]})},C=n(159);n(251);var N=function(e){var t=e.label,n=e.defaultStatus,c=e.children,s=e.disabled,i=e.className,r=e.data,l=(e.step,Object(o.useState)(r?!r:null)),j=Object(a.a)(l,2),u=j[0],b=j[1];return Object(o.useEffect)((function(){b(n)}),[n]),Object(x.jsxs)("div",{className:"step ".concat(u||n?"open":""," ").concat(s?"disabled":""," ").concat(i||""),children:[Object(x.jsxs)("div",{className:"head",onClick:function(){n||b(!u)},children:[Object(x.jsx)(d.g,{className:"chev"})," ",t,Object(x.jsx)("div",{className:"status",children:r&&Object(x.jsx)(d.A,{})})]}),(u||n)&&Object(x.jsx)("div",{className:"body",children:c})]})},M=function(e){var t,n,c=e.setLoading,i=Object(o.useContext)(j.d),r=i.user,l=i.setUser,u=window.FB,b=Object(o.useState)([]),h=Object(a.a)(b,2),O=h[0],f=h[1],p=Object(o.useState)(null),m=Object(a.a)(p,2),v=m[0],g=m[1];return Object(o.useEffect)((function(){var e,t;(null===(e=r.fbMarket)||void 0===e||null===(t=e.business)||void 0===t?void 0:t.id)||u.api("/me","GET",{fields:"businesses{picture{url},name,id,created_time}",access_token:d.p.get("facebook_user_accessToken")},(function(e){e.businesses&&f(e.businesses.data)}))}),[r]),Object(x.jsx)(x.Fragment,{children:(null===(t=r.fbMarket)||void 0===t||null===(n=t.businessManager)||void 0===n?void 0:n.id)?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{className:"note",children:"The Business Manager that owns all your Facebook business accounts."}),Object(x.jsx)("ul",{children:Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:r.fbMarket.businessManager.profileImg}),Object(x.jsxs)("div",{className:"detail",children:[Object(x.jsxs)("a",{href:"https://business.facebook.com/latest/home?nav_ref=bm_home_redirect&business_id=".concat(r.fbMarket.businessManager.id),children:[r.fbMarket.businessManager.name," ",Object(x.jsx)(d.j,{})]}),Object(x.jsxs)("span",{children:["ID: ",r.fbMarket.businessManager.id]}),Object(x.jsxs)("span",{children:["Created at:"," ",Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mm a",children:r.fbMarket.businessManager.created_time})]})]})]}),Object(x.jsx)("button",{onClick:function(){Object(C.updateProfileInfo)({"fbMarket.businessManager":{},"fbMarket.facebookPage":{},"fbMarket.commerceAccount":{},"fbMarket.userAgreement":!1}).then((function(e){var t=e.user;l((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))},className:"btn",children:"Disconnect"})]})})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{className:"note",children:"Connect the Business Manager you use to manage your business Page, accounts, and product catalog. You can only connect a Business Manager you have admin access to."}),Object(x.jsx)("p",{className:"note",children:"After you connect, you may receive a verification email from Facebook. If so, you\u2019ll need to confirm your business email address before proceeding."}),v&&Object(x.jsx)("div",{className:"err",children:v}),Object(x.jsxs)("ul",{children:[O.map((function(e,t){return Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:e.picture.data.url}),Object(x.jsxs)("div",{className:"detail",children:[Object(x.jsxs)("a",{href:"https://business.facebook.com/latest/home?nav_ref=bm_home_redirect&business_id=".concat(e.business_id,"&asset_id=").concat(e.asset_id),children:[e.name," ",Object(x.jsx)(d.j,{})]}),Object(x.jsxs)("span",{children:["ID: ",e.id]}),Object(x.jsxs)("span",{children:["Created at:"," ",Object(x.jsx)(d.s,{format:"DD MMM YYYY, hh:mm a",children:e.created_time})]})]})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){Object(C.updateProfileInfo)({"fbMarket.businessManager.id":e.id,"fbMarket.businessManager.name":e.name,"fbMarket.businessManager.createdAt":e.created_time,"fbMarket.businessManager.profileImg":e.picture.data.url}).then((function(e){var t=e.user;l((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))},children:"Connect"})]},t)})),Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:"/profile-user.jpg"}),Object(x.jsx)("p",{children:"Create Business Manager"})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){c(!0),u.api("/me/businesses","POST",{name:"Delivery Pay Business Manager",vertical:"ECOMMERCE"},(function(e){c(!1),console.log(e),e.id&&u.api("/me","GET",{fields:"businesses{picture{url},name,id,created_time}"},(function(e){e.businesses&&f(e.businesses.data)})),e.error&&(1===e.error.code?g(Object(x.jsx)(x.Fragment,{children:"You have reached maximum number of business manager one user can have. Use one of existing business manager instead of creating a new one."})):3947===e.error.code?g(Object(x.jsx)(x.Fragment,{children:'You already have a Business Manager with the same name. Select "Delivery Pay Business Manager" instead of creating a new one. or Choose another.'})):g(Object(x.jsx)(x.Fragment,{children:e.error.error_user_msg||e.error.message})))}))},children:"Create new"})]})]})]})})},S=function(){var e,t,n=window.FB,c=Object(o.useContext)(j.d),i=c.user,r=c.setUser,l=Object(o.useState)([]),b=Object(a.a)(l,2),h=b[0],O=b[1],f=Object(o.useState)(!1),p=Object(a.a)(f,2),m=p[0],v=p[1];return Object(o.useEffect)((function(){var e,t;(null===(e=i.fbMarket)||void 0===e||null===(t=e.business)||void 0===t?void 0:t.id)||n.api("/me/accounts","GET",{fields:"picture{url},access_token,name,category,business",access_token:d.p.get("facebook_user_accessToken")},(function(e){console.log("facebook pages:",e),e.data&&O(e.data)}))}),[i]),Object(x.jsxs)(x.Fragment,{children:[(null===(e=i.fbMarket)||void 0===e||null===(t=e.facebookPage)||void 0===t?void 0:t.id)?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{className:"note",children:"The Facebook business Page that you use to sell your products or post ads."}),Object(x.jsx)("ul",{children:Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:i.fbMarket.facebookPage.profileImg}),Object(x.jsxs)("div",{className:"detail",children:[Object(x.jsxs)("a",{href:"https://business.facebook.com/latest/home?nav_ref=bm_home_redirect&business_id=".concat(i.fbMarket.businessManager.id),children:[i.fbMarket.facebookPage.name," ",Object(x.jsx)(d.j,{})]}),Object(x.jsxs)("span",{children:["Category: ",i.fbMarket.facebookPage.category]})]})]}),Object(x.jsx)("button",{onClick:function(){Object(C.updateProfileInfo)({"fbMarket.facebookPage":{},"fbMarket.commerceAccount":{},"fbMarket.userAgreement":!1}).then((function(e){var t=e.user;console.log(t.fbMarket),r((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))},className:"btn",children:"Disconnect"})]})})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{className:"note",children:"Connect the business Page you use to sell products or post ads. You can only connect a Page you have admin access to."}),Object(x.jsxs)("ul",{children:[h.map((function(e,t){return Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:e.picture.data.url}),Object(x.jsxs)("div",{className:"detail",children:[Object(x.jsxs)("a",{href:"https://business.facebook.com/latest/home?nav_ref=bm_home_redirect&business_id=".concat(e.business_id,"&asset_id=").concat(e.asset_id),children:[e.name," ",Object(x.jsx)(d.j,{})]}),Object(x.jsx)("span",{children:e.category})]})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){Object(C.updateProfileInfo)({"fbMarket.facebookPage.id":e.id,"fbMarket.facebookPage.name":e.name,"fbMarket.facebookPage.access_token":e.access_token,"fbMarket.facebookPage.profileImg":e.picture.data.url,"fbMarket.facebookPage.category":e.category}).then((function(e){var t=e.user;r((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))},children:"Connect"})]},t)})),Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:"/profile-user.jpg"}),Object(x.jsx)("p",{children:"Create Page"})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){return v(!0)},children:"Create new"})]})]})]}),Object(x.jsx)(u.Modal,{head:!0,label:"Create a new Facebook business Page",open:m,setOpen:function(){v(!1),n.api("/me/accounts","GET",{fields:"picture{url},access_token,name,category,business",access_token:d.p.get("facebook_user_accessToken")},(function(e){console.log("facebook pages:",e),e.data&&O(e.data)}))},className:"createNewPage",children:Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)("p",{children:"You'll be redirected to Facebook where you can create a new business Page. All you need for now are basic details such as:"}),Object(x.jsxs)("ul",{children:[Object(x.jsx)("li",{children:"Business Page name"}),Object(x.jsx)("li",{children:"Business Page category"}),Object(x.jsx)("li",{children:"Profile Photo"}),Object(x.jsx)("li",{children:"Cover photo"}),Object(x.jsx)("li",{children:"Store description"})]}),Object(x.jsx)("p",{children:"As soon as you add these details, return to Delivery Pay and finish setup. You can always update your Page later."}),Object(x.jsxs)("a",{target:"_blank",href:"https://www.facebook.com/pages/create/?ref_type=hc",children:[Object(x.jsx)(d.j,{})," Go to Facebook"]})]})})]})},F=function(e){var t,n,c=e.setStep,i=window.FB,u=Object(o.useContext)(j.d),b=u.user,h=u.setUser,O=Object(o.useState)([]),f=Object(a.a)(O,2),p=(f[0],f[1],Object(o.useState)(null===(t=b.fbMarket)||void 0===t||null===(n=t.commerceAccount)||void 0===n?void 0:n.catalog)),m=Object(a.a)(p,2),v=m[0],g=m[1];return Object(o.useEffect)((function(){var e,t;g(null===(e=b.fbMarket)||void 0===e||null===(t=e.commerceAccount)||void 0===t?void 0:t.catalog)}),[b]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("p",{className:"note",children:["Create a Commerce account to start selling on Facebook, Instagram, or both. Once you have an account you\u2019ll be able to customize your Shop and collections in the"," ",Object(x.jsxs)("a",{target:"_blank",href:"https://www.facebook.com/business/help/2371372636254534",children:["Facebook Commerce Manager ",Object(x.jsx)(d.j,{})]}),"."]}),Object(x.jsxs)("ul",{children:[v&&Object(x.jsxs)("li",{className:"catalog",children:[Object(x.jsx)("p",{children:"PRODUCTS WILL BE SYNCED TO THIS CATALOG"}),Object(x.jsx)("p",{children:v.name}),Object(x.jsxs)("span",{children:["ID: ",v.id]})]}),!v&&Object(x.jsxs)("li",{children:[Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)(d.n,{src:"/profile-user.jpg"}),Object(x.jsx)("p",{children:"Create a new Commerce Account"})]}),Object(x.jsx)("button",{className:"btn",onClick:function(){i.api("/".concat(b.fbMarket.businessManager.id,"/owned_product_catalogs"),"GET",{access_token:d.p.get("facebook_user_accessToken")},function(){var e=Object(l.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,e.t0=n.find((function(e){return"Delivery Pay Product Catalog"===e.name})),e.t0){e.next=6;break}return e.next=5,i.api("/".concat(b.fbMarket.businessManager.id,"/owned_product_catalogs"),"POST",{name:"Delivery Pay Product Catalog",access_token:d.p.get("facebook_user_accessToken")},(function(e){return console.log(e.id),e.id?Object(s.a)(Object(s.a)({},e),{},{name:"Delivery Pay Product Catalog"}):null}));case 5:e.t0=e.sent;case 6:(a=e.t0)&&(g(a),Object(C.updateProfileInfo)({"fbMarket.commerceAccount.catalog":a}).then((function(e){var t=e.user;h((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})})),c("terms")})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},children:"Create new"})]})]})]})},P=function(){var e,t,n,c,i,r,l,b,O,f,p,m,v,g,k,y,P,D,_,A,w,T,I,Y,E,q,R=Object(o.useState)(null),B=Object(a.a)(R,2),U=B[0],V=B[1],G=Object(o.useContext)(j.d),L=G.user,H=G.setUser,J=window.FB,W=Object(o.useState)(""),K=Object(a.a)(W,2),z=K[0],Z=K[1],Q=Object(o.useState)(!1),$=Object(a.a)(Q,2),X=($[0],$[1]);return Object(o.useEffect)((function(){var e,t,n,c,s,a,i,r,l,o;console.log(L.fbMarket),(null===(e=L.fbMarket)||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id)?(null===(n=L.fbMarket)||void 0===n||null===(c=n.businessManager)||void 0===c?void 0:c.id)?(null===(s=L.fbMarket)||void 0===s||null===(a=s.facebookPage)||void 0===a?void 0:a.id)?(null===(i=L.fbMarket)||void 0===i||null===(r=i.commerceAccount)||void 0===r||null===(l=r.catalog)||void 0===l?void 0:l.id)?(null===(o=L.fbMarket)||void 0===o?void 0:o.userAgreement)||Z("terms"):Z("commerceAccount"):Z("fbPage"):Z("businessManager"):Z("account")}),[L]),Object(o.useEffect)((function(){}),[]),Object(x.jsxs)("div",{className:"fbMarket",children:[Object(x.jsx)("h1",{children:"Facebook marketplace"}),Object(x.jsxs)("div",{className:"setup",children:[Object(x.jsxs)(N,{data:(null===(e=L.fbMarket)||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id)?L.fbMarket.user:null,defaultStatus:"account"===z,step:z,label:"Facebook Account",children:[Object(x.jsx)("p",{className:"note",children:"Delivery Pay uses your personal Facebook account to access your business accounts."}),(null===(n=L.fbMarket)||void 0===n||null===(c=n.user)||void 0===c?void 0:c.id)&&Object(x.jsx)("p",{children:"Now you can log into Delivery Pay using this account."}),Object(x.jsxs)("div",{className:"profile",children:[Object(x.jsx)("div",{className:"user",children:(null===(i=L.fbMarket)||void 0===i||null===(r=i.user)||void 0===r?void 0:r.id)?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.n,{src:L.fbMarket.user.profileImg||"/profile-user.jpg"},"img"),Object(x.jsx)("p",{children:L.fbMarket.user.name})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.n,{src:"/profile-user.jpg"},"placeholder"),Object(x.jsx)("p",{children:"Connect your Facebook account to get started"})]})}),(null===(l=L.fbMarket)||void 0===l||null===(b=l.user)||void 0===b?void 0:b.id)?Object(x.jsx)("button",{className:"btn",onClick:function(){J.logout((function(e){console.log(e)})),d.p.remove("facebook_user_accessToken"),Object(C.updateProfileInfo)({"fbMarket.user":{},"fbMarket.businessManager":{},"fbMarket.facebookPage":{},"fbMarket.dataSharing":null,"fbMarket.commerceAccount":{},"fbMarket.userAgreement":!1}).then((function(e){var t=e.user;H((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))},children:"Disconnect"}):Object(x.jsx)("button",{className:"btn",onClick:function(){J.login((function(e){var t;d.p.set("facebook_user_accessToken",null===(t=e.authResponse)||void 0===t?void 0:t.accessToken);var n=e.authResponse.accessToken;fetch("/api/updateFBMarketUser",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:n})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code&&(console.log("long_lived_token saved"),d.p.set("facebook_user_accessToken",e.long_lived_token))})),J.api("/me","GET",{fields:"name,picture.type(large){url}"},(function(e){console.log(e),e.id&&Object(C.updateProfileInfo)({"fbMarket.user.name":e.name,"fbMarket.user.id":e.id,"fbMarket.user.profileImg":e.picture.data.url}).then((function(e){var t=e.user;H((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})}))}))}))}))},children:"Connect Account"})]})]}),Object(x.jsx)(N,{disabled:!(null===(O=L.fbMarket)||void 0===O||null===(f=O.user)||void 0===f?void 0:f.id),data:(null===(p=L.fbMarket)||void 0===p||null===(m=p.businessManager)||void 0===m?void 0:m.id)?L.fbMarket.businessManager:null,defaultStatus:"businessManager"===z,label:"Business Manager",className:"businessManager",children:Object(x.jsx)(M,{setLoading:X})}),Object(x.jsx)(N,{data:(null===(v=L.fbMarket)||void 0===v||null===(g=v.facebookPage)||void 0===g?void 0:g.id)?L.fbMarket.facebookPage:null,defaultStatus:"fbPage"===z,label:"Facebook Page",className:"page",disabled:!(null===(k=L.fbMarket)||void 0===k||null===(y=k.businessManager)||void 0===y?void 0:y.id),children:Object(x.jsx)(S,{})}),Object(x.jsx)(N,{data:(null===(P=L.fbMarket)||void 0===P||null===(D=P.commerceAccount)||void 0===D||null===(_=D.catalog)||void 0===_?void 0:_.id)?L.fbMarket.commerceAccount:null,disabled:!(null===(A=L.fbMarket)||void 0===A||null===(w=A.facebookPage)||void 0===w?void 0:w.id),label:"Facebook Commerce Account",defaultStatus:"commerceAccount"===z,className:"commerceAccount",children:Object(x.jsx)(F,{setStep:Z})}),Object(x.jsxs)(N,{disabled:!(null===(T=L.fbMarket)||void 0===T||null===(I=T.commerceAccount)||void 0===I||null===(Y=I.catalog)||void 0===Y?void 0:Y.id),data:(null===(E=L.fbMarket)||void 0===E?void 0:E.userAgreement)||null,defaultStatus:"terms"===z,label:"Terms and Conditions",children:[Object(x.jsxs)("p",{children:["By proceeding, you accept"," ",Object(x.jsxs)("a",{target:"_blank",href:"https://www.facebook.com/legal/commerce_product_merchant_agreement",children:["Facebook Commerce Terms ",Object(x.jsx)(d.j,{})]}),"."]}),!(null===(q=L.fbMarket)||void 0===q?void 0:q.userAgreement)&&Object(x.jsx)("button",{className:"btn",onClick:function(){Object(C.updateProfileInfo)({"fbMarket.userAgreement":!0}).then((function(e){var t=e.user;H((function(e){return Object(s.a)(Object(s.a)({},e),{},{fbMarket:t.fbMarket})})),Z(""),V(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return V(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Facebook marketplace has been setup successfully. Now you can add products to facebook marketplace directly from Delivery Pay."}),Object(x.jsx)(h.b,{to:"/account/myShop/products",children:"Add your first product"})]})]}))}))},children:"Finish setup"})]})]}),Object(x.jsx)(u.Modal,{open:U,className:"msg",children:U})]})},D=n(252);n(256);var _=function(e){var t,n,i,b,f,p=e.prefill,m=e.onSuccess,v=e.categories,g=Object(o.useContext)(j.d).user,k=Object(o.useState)(!1),y=Object(a.a)(k,2),C=y[0],N=y[1],M=Object(o.useState)((null===p||void 0===p?void 0:p.type)||"product"),S=Object(a.a)(M,2),F=S[0],P=S[1],D=Object(o.useState)((null===p||void 0===p?void 0:p.category)||""),_=Object(a.a)(D,2),A=_[0],w=_[1],T=Object(o.useState)({type:(null===p||void 0===p||null===(t=p.discount)||void 0===t?void 0:t.type)||null,amount:(null===p||void 0===p||null===(n=p.discount)||void 0===n?void 0:n.amount)||0,dscr:(null===p||void 0===p||null===(i=p.discount)||void 0===i?void 0:i.dscr)||""}),I=Object(a.a)(T,2),Y=I[0],E=I[1],q=Object(o.useState)((null===p||void 0===p?void 0:p.name)||""),R=Object(a.a)(q,2),B=R[0],U=R[1],V=Object(o.useState)((null===p||void 0===p?void 0:p.dscr)||""),G=Object(a.a)(V,2),L=G[0],H=G[1],J=Object(o.useState)((null===p||void 0===p?void 0:p.price)||""),W=Object(a.a)(J,2),K=W[0],z=W[1],Z=Object(o.useState)((null===p||void 0===p?void 0:p.images)||[]),Q=Object(a.a)(Z,2),$=Q[0],X=Q[1],ee=Object(o.useState)((null===p||void 0===p?void 0:p.gst)||(null===(b=g.gst)||void 0===b?void 0:b.verified)?g.gst.amount:0),te=Object(a.a)(ee,2),ne=te[0],ce=te[1],se=Object(o.useState)((null===p||void 0===p?void 0:p.hsn)||""),ae=Object(a.a)(se,2),ie=ae[0],re=ae[1],le=Object(o.useState)(null===p||void 0===p?void 0:p.available),oe=Object(a.a)(le,2),je=oe[0],de=oe[1],ue=Object(o.useState)(null),be=Object(a.a)(ue,2),he=be[0],Oe=be[1],fe=Object(o.useState)((null===p||void 0===p?void 0:p.tags)||[]),xe=Object(a.a)(fe,2),pe=xe[0],me=xe[1],ve=function(){var e=Object(l.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),N(!0),!$.length){e.next=8;break}return e.next=5,Object(d.F)({files:$,setMsg:Oe});case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=[];case 9:n=e.t0,fetch("/api/".concat(p?"edit":"add","Product"),{method:p?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(s.a)({type:F,name:B,dscr:L,price:+K,images:n,category:A,tags:pe,available:!0===je||!1===je?je:+je,gst:ne,discount:Y},p&&{_id:p._id}))}).then((function(e){return e.json()})).then((function(e){N(!1),"ok"===e.code?null===m||void 0===m||m(e.product):403===e.code?Oe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return Oe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"You can't add more that 100 product at a time. Delete a product/service and try again."})]})]})):Oe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return Oe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add product. please try again."})]})]}))})).catch((function(e){N(!1),console.log(e),Oe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return Oe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add product. Make sure you're online."})]})]}))}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("form",{onSubmit:ve,className:C?"loading":"",children:[Object(x.jsxs)("section",{className:"type",children:[Object(x.jsx)("label",{children:"Type"}),Object(x.jsx)(d.h,{defaultValue:F,options:[{label:"Product",value:"product"},{label:"Service",value:"service"},{label:"Other",value:"other"}],onChange:function(e){P(e.value)}})]}),Object(x.jsxs)("section",{className:"name",children:[Object(x.jsx)("label",{children:"Name of the product/service"}),Object(x.jsx)("input",{value:B,onChange:function(e){return U(e.target.value)},required:!0})]}),Object(x.jsxs)("section",{className:"category",children:[Object(x.jsxs)("label",{children:["Category"," ",Object(x.jsxs)(d.E,{children:["You can Add/Edit/Delete your categories"," ",Object(x.jsx)(h.b,{to:"/account/myShop/settings",children:"here"})]})]}),Object(x.jsx)(d.h,{required:!0,defaultValue:A,options:v.map((function(e){return{label:e,value:e}})),onChange:function(e){return w(e.value)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Price \u20b9"}),Object(x.jsx)(d.t,{defaultValue:K,onChange:function(e){return z(e.target.value)},required:!0})]}),Object(x.jsx)("section",{className:"available",children:"product"===F?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("label",{children:"Available in stock"}),Object(x.jsx)(d.t,{required:!0,defaultValue:je,onChange:function(e){return de(e.target.value)}})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("label",{children:"Availability"}),Object(x.jsx)(d.h,{defaultValue:je,required:!0,options:[{label:"Available",value:!0},{label:"Not available",value:!1}],onChange:function(e){return de(e.value)}})]})}),Object(x.jsxs)("section",{className:"dscr",children:[Object(x.jsx)("label",{children:"Description of the product/service"}),Object(x.jsx)(O.a,{value:L,onChange:function(e){return H(e.target.value)},required:!0})]}),Object(x.jsxs)("section",{className:"tags",children:[Object(x.jsx)("label",{children:"Tags"}),Object(x.jsxs)("ul",{children:[pe.map((function(e){return Object(x.jsxs)("li",{children:[e,Object(x.jsx)("button",{onClick:function(){me((function(t){return t.filter((function(t){return t!==e}))}))},children:Object(x.jsx)(d.H,{})})]},e)})),Object(x.jsxs)("li",{className:"form",children:[Object(x.jsx)("input",{placeholder:"addNewTag",onKeyPress:function(e){var t="".concat(e.target.value.trim());if(13===e.charCode){if(e.preventDefault(),!t)return;me((function(e){return[].concat(Object(c.a)(e.filter((function(e){return e!==t}))),[t])})),e.target.focus(),e.target.value=""}}}),Object(x.jsx)("button",{type:"button",onClick:function(e){var t=e.target.previousElementSibling,n="".concat(e.target.previousElementSibling.value.trim());n&&(me((function(e){return[].concat(Object(c.a)(e.filter((function(e){return e!==n}))),[n])})),t.value="",t.focus())},children:"Add Tag"})]})]})]}),Object(x.jsxs)("section",{className:"images",children:[Object(x.jsx)("label",{children:"Images of the product"}),Object(x.jsx)(d.k,{multiple:!0,prefill:null===p||void 0===p?void 0:p.images,accept:"image/*",onChange:function(e){return X(e)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"HSN Code"}),Object(x.jsx)("input",{value:ie,onChange:function(e){return re(e.target.value)}})]}),(null===(f=g.gst)||void 0===f?void 0:f.verified)&&Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"GST (%)"}),Object(x.jsx)(d.t,{defaultValue:ne,onChange:function(e){return ce(e.target.value)}})]}),Object(x.jsxs)("section",{className:"discountType",children:[Object(x.jsx)("label",{children:"Discount Type"}),Object(x.jsx)(d.h,{defaultValue:Y.type,options:[{label:"None",value:null},{label:"Percent",value:"percent"},{label:"Flat",value:"flat"}],onChange:function(e){return E((function(t){return Object(s.a)(Object(s.a)({},t),{},{type:e.value})}))}})]}),null!==Y.type&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("section",{className:"discountAmount",children:[Object(x.jsxs)("label",{children:["Amount ","percent"===Y.type&&"(%)"]}),Object(x.jsx)(d.t,{defaultValue:Y.amount,onChange:function(e){return E((function(t){return Object(s.a)(Object(s.a)({},t),{},{amount:e.target.value})}))}})]}),Object(x.jsxs)("section",{className:"discountDscr",children:[Object(x.jsx)("label",{children:"Discount description"}),Object(x.jsx)(O.a,{defaultValue:Y.dscr,onChange:function(e){return E((function(t){return Object(s.a)(Object(s.a)({},t),{},{dscr:e.target.value})}))}})]})]}),K&&Object(x.jsxs)("section",{className:"finalPrice",children:[Object(x.jsxs)("p",{children:[Object(x.jsx)("label",{children:"Input price"}),K]}),+ne>0&&Object(x.jsxs)("p",{className:"gst",children:[Object(x.jsxs)("label",{children:["GST ",ne,"%"]}),"+",(+K/100*+ne).fix()]}),Y.amount>0&&"flat"===Y.type&&Object(x.jsxs)("p",{children:[Object(x.jsx)("label",{children:"Discount flat"}),"- \u20b9",(+Y.amount).fix()]}),Y.amount>0&&"percent"===Y.type&&Object(x.jsxs)("p",{children:[Object(x.jsxs)("label",{children:["Discount ",Y.amount,"%"]}),"- \u20b9",(+K/100*Y.amount).fix()]}),Object(x.jsxs)("p",{className:"final",children:[Object(x.jsx)("label",{children:"Listing Price"}),"\u20b9",(+K+ +K/100*+ne-("percent"===Y.type?+K/100*Y.amount:0)-("flat"===Y.type?Y.amount:0)).fix()]})]}),Object(x.jsx)("section",{className:"btns",children:Object(x.jsx)("button",{className:"submit",type:"submit",children:"Submit"})}),Object(x.jsx)("div",{className:"pBtm"})]}),C&&Object(x.jsx)("div",{className:"spinnerContainer",children:Object(x.jsx)("div",{className:"spinner"})}),Object(x.jsx)(u.Modal,{className:"msg",open:he,children:he})]})},A=function(e){var t,n=e.categories,i=e.shopSetupComplete,r=Object(o.useContext)(j.d).user,l=(window.FB,Object(o.useState)(!1)),b=Object(a.a)(l,2),O=b[0],f=b[1],p=Object(o.useState)(0),m=Object(a.a)(p,2),v=m[0],g=m[1],k=Object(o.useState)(1),y=Object(a.a)(k,2),C=y[0],N=y[1],M=Object(o.useState)(20),S=Object(a.a)(M,2),F=S[0],P=S[1],D=Object(o.useState)(""),A=Object(a.a)(D,2),I=A[0],Y=A[1],E=Object(o.useState)(""),q=Object(a.a)(E,2),R=q[0],B=q[1],U=Object(o.useState)({column:"createdAt",order:"dsc"}),V=Object(a.a)(U,2),G=V[0],L=(V[1],Object(o.useState)(null)),H=Object(a.a)(L,2),J=H[0],W=H[1],K=Object(o.useState)(""),z=Object(a.a)(K,2),Z=z[0],Q=z[1],$=Object(o.useState)([]),X=Object(a.a)($,2),ee=X[0],te=X[1],ne=Object(o.useState)(!1),ce=Object(a.a)(ne,2),se=ce[0],ae=ce[1],ie=Object(o.useState)([]),re=Object(a.a)(ie,2),le=re[0],oe=re[1],je=Object(o.useState)(!1),de=Object(a.a)(je,2),ue=de[0],be=de[1],he=Object(o.useState)(null),Oe=Object(a.a)(he,2),fe=Oe[0],xe=Oe[1],pe=function(e){e.length&&fetch("/api/deleteProducts",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_ids:e})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?(oe([]),te((function(t){return t.filter((function(t){return!e.some((function(e){return e===t._id}))}))}))):xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not delete products. Try again."})]})]}))})).catch((function(e){console.log(e),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not delete products. Make sure you're online."})]})]}))}))},me=function(){return pe(le)},ve=function(e){fetch("/api/addToFbMarket",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({_ids:e,access_token:d.p.get("facebook_user_accessToken")})}).then((function(e){return e.json()})).then((function(e){var t=e.code,n=e.fb_products;if("ok"===t){var c=[],a=[];n.forEach((function(e,t){e.success?c.push(e):a.push(e)})),te((function(e){return e.map((function(e){var t=n.find((function(t){return t._id===e._id}));return t?Object(s.a)(Object(s.a)({},e),{},{fbMarketId:t.fbMarketId}):e}))})),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsx)("div",{children:0===a.length?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.C,{}),Object(x.jsxs)("h4",{children:[c.length," products has been added."]})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.i,{}),Object(x.jsxs)("h4",{children:[a.length," products failed."]})]})})]}))}else xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products to Facebook Marketplace."})]})]}))})).catch((function(e){console.log(e),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products to Facebook Marketplace. Make sure you're online."})]})]}))}))},ge=function(e){fetch("/api/removeFromFbMarket",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_ids:e,access_token:d.p.get("facebook_user_accessToken")})}).then((function(e){return e.json()})).then((function(e){var t=e.code,n=e.fb_products;if("ok"===t){var c=[],a=[];n.forEach((function(e,t){e.success?c.push(e):a.push(e)})),te((function(e){return e.map((function(e){var t=n.find((function(t){return t._id===e._id}));return t?Object(s.a)(Object(s.a)({},e),{},{fbMarketId:t.fbMarketId}):e}))})),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsx)("div",{children:0===a.length?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.C,{}),Object(x.jsxs)("h4",{children:[c.length," products has been removed."]})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.i,{}),Object(x.jsxs)("h4",{children:[a.length," products failed to remove."]})]})})]}))}else xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not remove products from Facebook Marketplace."})]})]}))})).catch((function(e){console.log(e),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not remove products from Facebook Marketplace. Make sure you're online."})]})]}))}))};return Object(o.useEffect)((function(){var e,t=Object(d.L)({time:null===J||void 0===J?void 0:J.startDate,format:"YYYY-MM-DD"}),n=Object(d.L)({time:null===(e=new Date(null===J||void 0===J?void 0:J.endDate))||void 0===e?void 0:e.setHours(24,0,0,0),format:"YYYY-MM-DD"});fetch("/api/products?".concat(new URLSearchParams(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)({},R&&{q:R}),{},{page:C,perPage:F,sort:G.column,order:G.order},J&&{dateFrom:t,dateTo:n}),I&&{category:I}),Z&&{type:Z})))).then((function(e){return e.json()})).then((function(e){"ok"===e.code&&(te(e.products),g(e.total))})).catch((function(e){console.log(e),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not get products."})]})]}))}))}),[I,R,C,F,Z,ue,J]),Object(o.useEffect)((function(){se||oe([])}),[se]),Object(o.useEffect)((function(){0===le.length&&ae(!1)}),[le]),Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("div",{className:"benner",children:[Object(x.jsx)("p",{children:"Product Management"}),i?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("button",{className:"pill",onClick:function(){return f(!0)},children:[Object(x.jsx)(d.v,{})," Add Product"]}),Object(x.jsxs)("button",{className:"pill batchUpload",onClick:function(){return be(!0)},children:[Object(x.jsx)(d.v,{})," Batch Upload"]})]}):Object(x.jsx)(h.b,{to:"/account/myShop/settings",className:"err",children:Object(x.jsx)("p",{children:"Please complete your shop information to add product."})})]}),Object(x.jsxs)("div",{className:"filters",children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Total:"}),v]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Per Page:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"20",value:20},{label:"30",value:30},{label:"50",value:50}],onChange:function(e){return P(e.value)}})]}),Object(x.jsxs)("section",{className:"search",children:[Object(x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"23",height:"23",viewBox:"0 0 23 23",children:Object(x.jsx)("path",{id:"Icon_ionic-ios-search","data-name":"Icon ionic-ios-search",d:"M27.23,25.828l-6.4-6.455a9.116,9.116,0,1,0-1.384,1.4L25.8,27.188a.985.985,0,0,0,1.39.036A.99.99,0,0,0,27.23,25.828ZM13.67,20.852a7.2,7.2,0,1,1,5.091-2.108A7.155,7.155,0,0,1,13.67,20.852Z",transform:"translate(-4.5 -4.493)",fill:"#707070",opacity:"0.74"})}),Object(x.jsx)("input",{value:R,onChange:function(e){return B(e.target.value)},placeholder:"Search for products & services"}),R&&Object(x.jsx)("button",{onClick:function(){return B("")},children:Object(x.jsx)(d.H,{})})]}),Object(x.jsxs)("section",{className:"type",children:[Object(x.jsx)("label",{children:"Type:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"All",value:""},{label:"Product",value:"product"},{label:"Service",value:"service"},{label:"Other",value:"other"}],onChange:function(e){return Q(e.value)}})]}),Object(x.jsxs)("section",{className:"category",children:[Object(x.jsx)("label",{children:"Category:"}),Object(x.jsx)(d.h,{defaultValue:0,options:[{label:"All",value:""}].concat(Object(c.a)(n.map((function(e){return{label:e,value:e}})))),onChange:function(e){return Y(e.value)}})]}),Object(x.jsx)("section",{className:"date",children:Object(x.jsx)(d.o,{dateRange:J,onChange:function(e){return W(e)}})})]}),Object(x.jsxs)("table",{className:"table products",children:[Object(x.jsx)("thead",{children:le.length>0?Object(x.jsxs)("tr",{className:"batchAction",children:[Object(x.jsx)("th",{className:"checkContainer",children:Object(x.jsx)(d.f,{value:se,defaultValue:se,onChange:function(e){return ae(e)}})}),Object(x.jsx)("th",{children:Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Batch delete",question:"You sure you want to delete these ".concat(le.length," items?"),callback:me})},children:"Delete"})}),(null===(t=r.fbMarket)||void 0===t?void 0:t.userAgreement)&&d.p.get("facebook_user_accessToken")&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("th",{children:Object(x.jsx)("button",{onClick:function(){ve(le),oe([])},children:"Add to Facebook"})}),Object(x.jsx)("th",{children:Object(x.jsx)("button",{onClick:function(){ge(le),oe([])},children:"Remove from Facebook"})})]})]}):Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{className:"checkContainer",children:Object(x.jsx)(d.f,{value:se,defaultValue:se,onChange:function(e){return ae(e)}})}),Object(x.jsx)("th",{className:"date",children:"Date"}),Object(x.jsx)("th",{children:"Image"}),Object(x.jsx)("th",{className:"name",children:"Name"}),Object(x.jsx)("th",{children:"Type"}),Object(x.jsx)("th",{children:"Facebook Marketplace"}),Object(x.jsx)("th",{children:"Available"}),Object(x.jsx)("th",{children:"Price"}),Object(x.jsx)("th",{children:"GST"}),Object(x.jsx)("th",{children:"Discount"}),Object(x.jsx)("th",{children:"Listing Price"}),Object(x.jsx)("th",{children:"Actions"})]})}),Object(x.jsxs)("tbody",{children:[ee.map((function(e){return Object(x.jsx)(w,{categories:n,product:e,setProducts:te,selectAll:se,setBatch:oe,batch:le,deleteItems:pe,addToFbMarket:ve,removeFromFbMarket:ge},e._id)})),0===ee.length&&Object(x.jsx)("tr",{className:"placeholder",children:Object(x.jsx)("td",{children:"No product yet."})})]})]}),Object(x.jsx)(d.u,{total:v,btns:5,currentPage:C,perPage:F,setPage:N}),Object(x.jsx)(u.Modal,{className:"msg",open:fe,children:fe}),Object(x.jsx)(u.Modal,{head:!0,label:"Edit Product/Service",setOpen:f,open:O,className:"productForm",children:Object(x.jsx)(_,{categories:n,onSuccess:function(e){te((function(t){return[].concat(Object(c.a)(t),[e])})),f(!1),xe(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return xe(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Product added."})]})]}))}})}),Object(x.jsx)(u.Modal,{open:ue,head:!0,label:"Batch product upload",setOpen:be,className:"batchItemPreview",children:Object(x.jsx)(T,{categories:n,onSuccess:function(){be(!1)}})})]})},w=function(e){var t,n,s,i,r=e.product,l=e.setProducts,b=e.categories,O=e.selectAll,f=e.setBatch,p=e.batch,m=e.deleteItems,v=e.addToFbMarket,g=e.removeFromFbMarket,k=Object(o.useContext)(j.d).user,y=Object(o.useState)(O||!1),C=Object(a.a)(y,2),N=C[0],M=C[1],S=Object(o.useState)(!1),F=Object(a.a)(S,2),P=F[0],D=F[1],A=Object(o.useState)(!1),w=Object(a.a)(A,2),T=w[0],I=w[1];return Object(o.useEffect)((function(){M(O)}),[O]),Object(o.useEffect)((function(){f(N?function(e){return[].concat(Object(c.a)(e),[r._id])}:function(e){return e.filter((function(e){return e!==r._id}))})}),[N]),Object(x.jsxs)("tr",{className:"product ".concat(N?"selected":""),children:[Object(x.jsx)("td",{className:"checkContainer",children:Object(x.jsx)(d.f,{defaultValue:N,value:N,onChange:function(e){M(e)}})}),Object(x.jsx)("td",{className:"date",children:Object(x.jsx)(d.s,{format:"DD-MM-YY",children:r.createdAt})}),Object(x.jsx)("td",{className:"thumbs",children:Object(x.jsx)(d.q,{links:r.images})}),Object(x.jsx)("td",{className:"name",children:r.name}),Object(x.jsx)("td",{children:r.type}),Object(x.jsx)("td",{children:r.fbMarketId?"Added":"N/A"}),Object(x.jsxs)("td",{children:[r.available," ",!0===r.available&&"Available",!1===r.available&&"Unavailable"]}),Object(x.jsxs)("td",{children:["\u20b9",r.price]}),Object(x.jsx)("td",{children:(null===(t=k.gst)||void 0===t?void 0:t.verified)?(r.gst||(null===(n=k.gst)||void 0===n?void 0:n.amount)||0)+"%":"N/A"}),Object(x.jsxs)("td",{children:["\u20b9",Object(d.J)(r)||0]}),Object(x.jsxs)("td",{children:["\u20b9",Object(d.K)({product:r,gst:k.gst})||0]}),Object(x.jsx)("td",{children:0===p.length&&Object(x.jsxs)(d.a,{icon:Object(x.jsx)(d.g,{}),children:[Object(x.jsx)(h.b,{to:"/marketplace/".concat(r._id),target:"_blank",children:"View"}),(null===(s=k.fbMarket)||void 0===s?void 0:s.userAgreement)&&d.p.get("facebook_user_accessToken")&&Object(x.jsx)(x.Fragment,{children:r.fbMarketId?Object(x.jsx)("button",{onClick:function(){return g([r._id])},children:"Remove from Facebook"}):Object(x.jsx)("button",{onClick:function(){return v([r._id])},children:"Add to Facebook"})}),!(null===(i=k.fbMarket)||void 0===i?void 0:i.userAgreement)&&Object(x.jsx)(h.b,{to:"/account/myShop/fbMarketplace",className:"edit",children:"Setup FB Marketplace"}),Object(x.jsx)(h.b,{to:"#",className:"edit",onClick:function(){return D(!0)},children:"Edit"}),Object(x.jsx)(h.b,{to:"#",className:"delete",onClick:function(){return Object(u.Confirm)({label:"Removing Product",question:"You sure want to delete this product?",callback:function(){return m([r._id])}})},children:"Delete"})]})}),Object(x.jsx)(u.Modal,{head:!0,label:"Edit Product/Service",open:P,setOpen:D,className:"productForm",children:Object(x.jsx)(_,{categories:b,onSuccess:function(e){l((function(t){return t.map((function(t){return t._id===e._id?e:t}))})),D(!1),I(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return I(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.C,{}),Object(x.jsx)("h4",{children:"Product updated."})]})]}))},prefill:r})}),Object(x.jsx)(u.Modal,{className:"msg",open:T,children:T})]})},T=function(e){var t=e.onSuccess,i=e.categories,j=Object(o.useState)(!1),b=Object(a.a)(j,2),h=b[0],O=b[1],f=Object(o.useState)(1),p=Object(a.a)(f,2),m=p[0],v=p[1],g=Object(o.useState)(null),k=Object(a.a)(g,2),y=k[0],C=k[1],M=Object(o.useState)([]),S=Object(a.a)(M,2),F=S[0],P=S[1],_=Object(o.useState)(null),A=Object(a.a)(_,2),w=A[0],T=A[1],I=Object(o.useState)(""),Y=Object(a.a)(I,2),E=Y[0],q=Y[1],R=Object(o.useState)(null),B=Object(a.a)(R,2),U=B[0],V=B[1],G=function(){O(!0),fetch("/api/updateDraft",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:y})}).then((function(e){return e.json()})).then((function(e){var n=e.code,c=e.updated;O(!1),T("ok"===n?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){T(null),null===t||void 0===t||t()},children:"Okay"}),Object(x.jsxs)("div",{children:[c?Object(x.jsx)(d.C,{}):Object(x.jsx)(d.i,{}),Object(x.jsxs)("h4",{children:[c," items has been updated."]})]})]}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return T(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products. Try again."})]})]}))})).catch((function(e){O(!1),console.log(e),T(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return T(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products. Make sure you're online."})]})]}))}))},L=function(){var e=Object(l.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),O(!0),e.next=4,Object(d.F)({files:F,setMsg:T});case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=[];case 7:if((n=e.t0).length===F.length){e.next=11;break}return T(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return T(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not upload images. Please try again."})]})]})),e.abrupt("return");case 11:fetch("/api/uploadProductImg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:n,category:E})}).then((function(e){return e.json()})).then((function(e){if("ok"===e.code){console.log(e);var t=Object.entries({Images:"images",id:"_id",Name:"name",Description:"dscr",Material:"material","Size [Please specify mm, cm, inch or KG]":"size",Category:"category",Type:"type","Price in INR.":"price","Units Available":"available","HSN Code":"hsn","GST %":"gst"}).map((function(e){var t=Object(a.a)(e,2);return{label:t[0],key:t[1]}}));console.log(t,e.products),V({headers:t,data:e.products,filename:"Delivery Pay Product Draft.csv"})}else T(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return T(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products. Make sure you're online."})]})]}))})).catch((function(e){O(!1),console.log(e),T(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return T(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add products. Make sure you're online."})]})]}))}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)("div",{className:"content",children:[Object(x.jsx)(N,{label:"Create Draft",className:"createDraft",defaultStatus:1===m,data:U,children:Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("form",{onSubmit:L,children:[Object(x.jsxs)("section",{className:"category",children:[Object(x.jsx)("label",{children:"Choose category"}),Object(x.jsx)(d.h,{options:i.map((function(e){return{label:e,value:e.toLowerCase()}})),required:!0,onChange:function(e){return q(e.value)}})]}),Object(x.jsxs)("p",{children:["Choose images"," ",Object(x.jsx)("span",{children:"Choose 1 image for each product. you can add multiple images later."})]}),Object(x.jsx)(d.k,{onChange:function(e){return P(e)},multiple:!0}),Object(x.jsxs)("section",{className:"btns",children:[Object(x.jsx)("button",{className:"clean",type:"button",onClick:function(){return v(3)},children:"Already have a draft"}),U?Object(x.jsx)(D.CSVLink,Object(s.a)(Object(s.a)({},U),{},{className:"submit",type:"submit",onClick:function(){V(null),v(2)},children:"Download Draft"})):Object(x.jsx)("button",{className:"submit",children:"Create Draft"})]})]})})}),Object(x.jsxs)(N,{label:"Populate With data",defaultStatus:2===m,children:[Object(x.jsx)("p",{children:"Populate the Sheet with real product data. Don't Change the header."}),Object(x.jsx)("button",{className:"submit",onClick:function(){return v(3)},children:"Next"})]}),Object(x.jsxs)(N,{label:"Upload Draft",defaultStatus:3===m,children:[!!(null===y||void 0===y?void 0:y.length)&&Object(x.jsxs)("table",{className:"table",children:[Object(x.jsx)("thead",{children:Object(x.jsxs)("tr",{children:[Object(x.jsx)("th",{children:"Type"}),Object(x.jsx)("th",{children:"Images"}),Object(x.jsx)("th",{className:"name",children:"Name"}),Object(x.jsx)("th",{className:"dscr",children:"Description"}),Object(x.jsx)("th",{children:"Available"}),Object(x.jsx)("th",{children:"Price"}),Object(x.jsx)("th",{children:"GST"}),Object(x.jsx)("th",{children:"Action"})]})}),Object(x.jsx)("tbody",{children:null===y||void 0===y?void 0:y.map((function(e,t){return Object(x.jsxs)("tr",{children:[Object(x.jsx)("td",{children:e.type}),Object(x.jsx)("td",{className:"thumbs",children:Object(x.jsx)(d.q,{links:e.images})}),Object(x.jsx)("td",{className:"name",children:e.name}),Object(x.jsx)("td",{className:"dscr",children:e.dscr}),Object(x.jsxs)("td",{children:[e.available,!0===e.available&&"Available",!1===e.available&&"Unavailable"]}),Object(x.jsx)("td",{children:e.price}),Object(x.jsx)("td",{children:e.gst}),Object(x.jsx)("td",{children:Object(x.jsx)("button",{className:"remove",onClick:function(){return C((function(e){var n=Object(c.a)(e);return n.splice(t,1),n}))},children:Object(x.jsx)(d.H,{})})})]},t)}))})]}),!(null===y||void 0===y?void 0:y.length)&&Object(x.jsxs)("div",{className:"uploadFile",children:[Object(x.jsxs)("p",{children:["Upload xlsx/csv file in. See the example file"," ",Object(x.jsx)("a",{href:"/batch_product_upload_xlsx_file_example.csv",target:"_blank",children:"here"}),"."]}),Object(x.jsx)("input",{type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:function(e){e.target.files[0]&&function(e,t){e.name;var c=new FileReader;c.onload=function(){var e=Object(l.a)(r.a.mark((function e(c){var s,a,i,l,o,j,d,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.target.result,e.next=3,Promise.all([n.e(27),n.e(28)]).then(n.t.bind(null,282,7));case 3:a=e.sent,i=a.read(s,{type:"binary"}),l=i.SheetNames[0],o=i.Sheets[l],j=a.utils.sheet_to_json(o,{header:1}),d=[],u=j.shift(),j.forEach((function(e,t){var n={};u.forEach((function(t,c){var s;switch(t){case"Images":s="images";break;case"Name":s="name";break;case"Description":s="dscr";break;case"Material":s="material";break;case"Size [Please specify mm, cm, inch or KG]":s="size";break;case"Category":s="category";break;case"Type":s="type";break;case"Price in INR.":s="price";break;case"Units Available":s="available";break;case"HSN Code":s="hsn";break;case"GST %":s="gst";break;case"id":s="_id"}n[s]=e[c]})),d.push(n)})),t(d);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.readAsBinaryString(e)}(e.target.files[0],(function(e){(null===e||void 0===e?void 0:e.length)&&C(e.filter((function(e){return e.type&&e.category&&e.name&&e.dscr&&void 0!==e.price})).map((function(e){return Object(s.a)(Object(s.a)({},e),{},{status:"",images:e.images.split(/,( |\n)/).filter((function(e){return e.trim()}))})})))})),e.target.value=null}})]}),!!(null===y||void 0===y?void 0:y.length)&&Object(x.jsx)("button",{className:"submit",onClick:function(){return Object(u.Confirm)({label:"Adding Batch products",question:"You sure want to add all these items?",callback:G})},children:"Add"})]}),h&&Object(x.jsx)("div",{className:"spinnerContainer",children:Object(x.jsx)("div",{className:"spinner"})}),Object(x.jsx)(u.Modal,{className:"msg",open:w,children:w})]})},I=["Buyer will be responsible for paying for shipping costs & for returning the item.","Shipping costs are nonrefundable.","Orders must be returned with Original Packaging & Securely.","Orders must be Returned Via Trackable / Traceable Courier Services Only.","Proof of Return via Photo of Tracking Number & Dispatch Ticket is Required.","Refund is Only Issued Upon Delivery of Return Package."],Y=function(e){var t,n,c,s,i,r,l,b,h,O,f,p,m,v,g,k,y,C,N,M,S,F,P,D,_,A,w,T,I,Y,U,V,G,L,H,J,W,K,z,Z=e.categories,Q=e.setCategories,$=Object(o.useContext)(j.d),X=$.user,ee=($.setUser,Object(o.useState)(!1)),te=Object(a.a)(ee,2),ne=te[0],ce=te[1],se=Object(o.useState)(!1),ae=Object(a.a)(se,2),ie=ae[0],re=ae[1],le=Object(o.useState)(),oe=Object(a.a)(le,2),je=oe[0],de=oe[1],ue=Object(o.useState)(!1),be=Object(a.a)(ue,2),he=be[0],Oe=be[1],fe=Object(o.useState)(null),xe=Object(a.a)(fe,2),pe=xe[0],me=xe[1];return Object(x.jsxs)("div",{className:"settings",children:[Object(x.jsxs)("div",{className:"caution",children:[!(null===Z||void 0===Z?void 0:Z.length)&&Object(x.jsx)("p",{className:"err",children:"Add at least 1 category."}),!(null===(t=X.shopInfo)||void 0===t||null===(n=t.terms)||void 0===n?void 0:n.length)&&Object(x.jsx)("p",{className:"err",children:"Add Return policy terms"}),(void 0===(null===(c=X.shopInfo)||void 0===c?void 0:c.shippingCost)||null===(null===(s=X.shopInfo)||void 0===s?void 0:s.shippingCost)||void 0===(null===(i=X.shopInfo)||void 0===i?void 0:i.deliveryWithin)||null===(null===(r=X.shopInfo)||void 0===r?void 0:r.deliveryWithin)||void 0===(null===(l=X.shopInfo)||void 0===l?void 0:l.refundable))&&Object(x.jsx)("p",{className:"err",children:"Add Shipping & Delivery detail"}),Object.values((null===(b=X.shopInfo)||void 0===b?void 0:b.paymentMethod)||{}).length<6&&Object(x.jsx)("p",{className:"err",children:"Add valid payment method"})]}),Object(x.jsxs)("div",{className:"cat",children:[Object(x.jsx)("h2",{className:"head",children:"Categories"}),Object(x.jsxs)("ul",{className:"categories",children:[Z.map((function(e,t){return Object(x.jsxs)("li",{children:[e," ",Object(x.jsx)("button",{onClick:function(){return Object(u.Confirm)({label:"Remove Category",question:"You sure want to remove this category?",callback:function(){fetch("/api/categories",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:e})}).then((function(e){return e.json()})).then((function(t){"ok"===t.code?Q((function(t){return t.filter((function(t){return t!==e}))})):me(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return me(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not delete category. Try again."})]})]}))})).catch((function(e){console.log(e),me(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return me(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not delete category. Make sure you're online."})]})]}))}))}})},children:Object(x.jsx)(d.H,{})})]},t)})),0===Z.length&&Object(x.jsx)("li",{className:"placeholder",children:"No category found."})]}),Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=e.target.querySelector("input");fetch("/api/addCategory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:t.value})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(Q(e.categories),t.value=""):me(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return me(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add category. Try again."})]})]}))})).catch((function(e){console.log(e),me(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return me(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not add category. Make sure you're online."})]})]}))}))},children:[Object(x.jsx)("input",{type:"text",required:!0,placeholder:"New Category. ie Mobile"}),Object(x.jsx)("button",{children:"Add category"})]})]}),Object(x.jsxs)("div",{className:"gst",children:[Object(x.jsxs)("h2",{className:"head",children:["GST"," ",!ne&&Object(x.jsx)("button",{onClick:function(){return ce(!0)},children:"Edit"})]}),Object(x.jsxs)("p",{className:"status",children:["Status:"," ",Object(x.jsx)("strong",{children:(null===(h=X.gst)||void 0===h?void 0:h.verified)?"Verified":"Unverified"})]}),ne?Object(x.jsx)(E,{setOpen:ce,setMsg:me}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("p",{children:["GST Registration number: ",(null===(O=X.gst)||void 0===O||null===(f=O.detail)||void 0===f?void 0:f.reg)||"N/A"]}),Object(x.jsxs)("p",{children:["GST amount: ",(null===(p=X.gst)||void 0===p?void 0:p.amount)?X.gst.amount+"%":"N/A"]}),Object(x.jsxs)("p",{children:["Files for verification:"," ",!(null===(m=X.gst)||void 0===m||null===(v=m.detail)||void 0===v||null===(g=v.files)||void 0===g?void 0:g.length)&&"N/A"]}),(null===(k=X.gst)||void 0===k||null===(y=k.detail)||void 0===y||null===(C=y.files)||void 0===C?void 0:C.length)&&Object(x.jsx)("ul",{className:"thumbs",children:Object(x.jsx)(d.q,{links:null===(N=X.gst)||void 0===N||null===(M=N.detail)||void 0===M?void 0:M.files})})]}),!(null===(S=X.gst)||void 0===S?void 0:S.verified)&&Object(x.jsx)("p",{className:"note",children:"*GST will apply once we review and verify your GST registraion."})]}),Object(x.jsxs)("div",{className:"payment",children:[Object(x.jsxs)("h2",{className:"head",children:["Payment Method"," ",!he&&Object(x.jsx)("button",{onClick:function(){return Oe(!0)},children:"Edit"})]}),he?Object(x.jsx)(B,{prefill:null===(F=X.shopInfo)||void 0===F?void 0:F.paymentMethod,setOpen:Oe,setMsg:me}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("p",{children:["Name: ",(null===(P=X.shopInfo)||void 0===P||null===(D=P.paymentMethod)||void 0===D?void 0:D.name)||"--"]}),Object(x.jsxs)("p",{children:["Bank: ",(null===(_=X.shopInfo)||void 0===_||null===(A=_.paymentMethod)||void 0===A?void 0:A.bank)||"--"]}),Object(x.jsxs)("p",{children:["City: ",(null===(w=X.shopInfo)||void 0===w||null===(T=w.paymentMethod)||void 0===T?void 0:T.city)||"--"]}),Object(x.jsxs)("p",{children:["Account type: ",(null===(I=X.shopInfo)||void 0===I||null===(Y=I.paymentMethod)||void 0===Y?void 0:Y.accountType)||"--"]}),Object(x.jsxs)("p",{children:["Account Number:"," ",(null===(U=X.shopInfo)||void 0===U||null===(V=U.paymentMethod)||void 0===V?void 0:V.accountNumber)||"--"]}),Object(x.jsxs)("p",{children:["ifsc: ",(null===(G=X.shopInfo)||void 0===G||null===(L=G.paymentMethod)||void 0===L?void 0:L.ifsc)||"--"]})]})]}),Object(x.jsxs)("div",{className:"terms shipping",children:[Object(x.jsxs)("h2",{className:"head",children:["Shipping & Delivery"," ",!ie&&Object(x.jsx)("button",{onClick:function(){return re(!0)},children:"Edit"})]}),ie?Object(x.jsx)(q,{setOpen:re,setMsg:me}):Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("p",{children:["Shipping cost:"," ",(null===(H=X.shopInfo)||void 0===H?void 0:H.shippingCost)?"\u20b9"+(null===(J=X.shopInfo)||void 0===J?void 0:J.shippingCost):"N/A"]}),Object(x.jsxs)("p",{children:["Delivery within (days): ",(null===(W=X.shopInfo)||void 0===W?void 0:W.deliveryWithin)||"N/A"]}),Object(x.jsxs)("p",{children:["Refundable: ",(null===(K=X.shopInfo)||void 0===K||null===(z=K.refundable)||void 0===z?void 0:z.toString())||"N/A"]})]})]}),Object(x.jsxs)("div",{className:"terms return",children:[Object(x.jsxs)("h2",{className:"head",children:["Return Policy Terms"," ",!je&&Object(x.jsx)("button",{onClick:function(){return de(!0)},children:"Edit"})]}),Object(x.jsx)(R,{setOpen:de,termsEdit:je,setMsg:me})]}),Object(x.jsx)(u.Modal,{className:"msg",open:pe,children:pe})]})},E=function(e){var t,n,c,i,u,b,h,O=e.setOpen,f=e.setMsg,p=Object(o.useContext)(j.d),m=p.user,v=p.setUser,g=Object(o.useState)(!1),k=Object(a.a)(g,2),y=(k[0],k[1]),N=Object(o.useState)([]),M=Object(a.a)(N,2),S=M[0],F=M[1],P=Object(o.useState)(null===(t=m.gst)||void 0===t||null===(n=t.detail)||void 0===n?void 0:n.reg),D=Object(a.a)(P,2),_=D[0],A=D[1],w=Object(o.useState)(null===(c=m.gst)||void 0===c?void 0:c.amount),T=Object(a.a)(w,2),I=T[0],Y=T[1],E=function(){var e=Object(l.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),y(!0),e.next=4,Object(d.F)({files:S,setMsg:f});case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0=[];case 7:n=e.t0,Object(C.updateProfileInfo)({"gst.detail.files":n,"gst.detail.reg":_,"gst.amount":I}).then((function(e){var t=e.user;y(!1),t&&(v((function(e){return Object(s.a)(Object(s.a)({},e),{},{gst:t.gst})})),O(!1))})).catch((function(e){y(!1),console.log(e),f(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return f(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not upadte GST Information. Make sure you're online"})]})]}))}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsxs)("form",{onSubmit:E,children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"GST Registration Nubmer"}),Object(x.jsx)("input",{required:!0,type:"text",defaultValue:null===(i=m.gst)||void 0===i?void 0:i.detail.reg,name:"gst.detail.reg",onChange:function(e){return A(e.target.value)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"GST percentage (%)"}),Object(x.jsx)(d.t,{required:!0,defaultValue:null===(u=m.gst)||void 0===u?void 0:u.amount,name:"gst.detail.reg",onChange:function(e){return Y(e.target.value)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Upload files for verification"}),Object(x.jsx)(d.k,{multiple:!0,prefill:null===(b=m.gst)||void 0===b||null===(h=b.detail)||void 0===h?void 0:h.files,name:"gst.detail.files",onChange:function(e){return F(e)}})]}),Object(x.jsxs)("section",{className:"btns",children:[Object(x.jsx)("button",{children:"Save Changes"}),Object(x.jsx)("button",{type:"button",onClick:function(){return O(!1)},children:"Cancel"})]})]})},q=function(e){var t,n,c,i=e.setOpen,r=e.setMsg,l=Object(o.useContext)(j.d),u=l.user,b=l.setUser,h=Object(o.useState)((null===(t=u.shopInfo)||void 0===t?void 0:t.shippingCost)||0),O=Object(a.a)(h,2),f=O[0],p=O[1],m=Object(o.useState)(null===(n=u.shopInfo)||void 0===n?void 0:n.deliveryWithin),v=Object(a.a)(m,2),g=v[0],k=v[1],y=Object(o.useState)((null===(c=u.shopInfo)||void 0===c?void 0:c.refundable)||null),N=Object(a.a)(y,2),M=N[0],S=N[1];return Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),Object(C.updateProfileInfo)({"shopInfo.shippingCost":f,"shopInfo.deliveryWithin":g,"shopInfo.refundable":M}).then((function(e){var t=e.user;t&&(b((function(e){return Object(s.a)(Object(s.a)({},e),{},{shopInfo:t.shopInfo})})),i(!1))})).catch((function(e){console.log(e),r(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return r(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not upadte Terms. Make sure you're online"})]})]}))}))},children:[Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Shipping Cost \u20b9"}),Object(x.jsx)(d.t,{required:!0,defaultValue:f,name:"shippingCost",onChange:function(e){return p(e.target.value)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Delivery Within (days)"}),Object(x.jsx)(d.t,{required:!0,defaultValue:g,name:"deliveryWithin",min:1,step:"0",placeholder:"ie. 4 Days",onChange:function(e){return k(e.target.value)}})]}),Object(x.jsxs)("section",{children:[Object(x.jsx)("label",{children:"Refundable"}),Object(x.jsx)(d.h,{required:!0,defaultValue:0,onChange:function(e){return S(e.value)},options:[{label:"No",value:null},{label:"Upto 24 Hours After Delivery",value:"Upto 24 Hours After Delivery"},{label:"Upto 7 Days After Delivery",value:"Upto 7 Days After Delivery"},{label:"Upto 15 Days After Delivery",value:"Upto 15 Days After Delivery"}]})]}),Object(x.jsxs)("section",{className:"btns",children:[Object(x.jsx)("button",{children:"Save Changes"}),Object(x.jsx)("button",{type:"button",onClick:function(){return i(!1)},children:"Cancel"})]})]})},R=function(e){var t,n=e.setOpen,i=e.termsEdit,r=e.setMsg,l=Object(o.useContext)(j.d),u=l.user,b=l.setUser,h=Object(o.useState)((null===(t=u.shopInfo)||void 0===t?void 0:t.terms)||[]),f=Object(a.a)(h,2),p=f[0],m=f[1],v=Object(o.useState)(""),g=Object(a.a)(v,2),k=g[0],y=g[1];return Object(o.useEffect)((function(){var e;i?0===p.length&&m(I):m((null===(e=u.shopInfo)||void 0===e?void 0:e.terms)||[])}),[i]),Object(x.jsxs)("form",{onSubmit:function(e){e.preventDefault(),Object(C.updateProfileInfo)({"shopInfo.terms":p}).then((function(e){var t,c=e.user;c&&(b((function(e){return Object(s.a)(Object(s.a)({},e),{},{shopInfo:c.shopInfo})})),n(!1),m(null===(t=c.shopInfo)||void 0===t?void 0:t.terms))})).catch((function(e){console.log(e),r(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return r(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not upadte Terms. Make sure you're online"})]})]}))}))},children:[Object(x.jsxs)("ul",{children:[p.map((function(e,t){return Object(x.jsxs)("li",{children:[e," ",i&&Object(x.jsx)("button",{type:"button",onClick:function(){return m((function(t){return t.filter((function(t){return t!==e}))}))},children:Object(x.jsx)(d.H,{})})]},t)})),0===p.length&&Object(x.jsx)("li",{children:"No terms has been added."})]}),i&&Object(x.jsxs)(x.Fragment,{children:[Object(x.jsxs)("section",{className:"addTerm",children:[Object(x.jsx)(O.a,{value:k,placeholder:"Add auditional term",onChange:function(e){return y(e.target.value)}}),Object(x.jsx)("button",{type:"button",onClick:function(){m((function(e){return k?[].concat(Object(c.a)(e.filter((function(e){return e!==k}))),[k]):e})),y("")},children:"Add Term"})]}),Object(x.jsxs)("section",{className:"btns",children:[Object(x.jsx)("button",{children:"Save Changes"}),Object(x.jsx)("button",{type:"button",onClick:function(){var e,t;n(!1),m((null===(e=u.shopInfo)||void 0===e||null===(t=e.terms)||void 0===t?void 0:t.length)?u.shopInfo.terms:I)},children:"Cancel"})]})]})]})},B=function(e){var t=e.prefill,n=(e.onSuccess,e.setMsg),c=e.setOpen,i=Object(o.useContext)(j.d).setUser,r=Object(o.useState)((null===t||void 0===t?void 0:t.bank)||""),l=Object(a.a)(r,2),u=l[0],b=l[1],h=Object(o.useState)((null===t||void 0===t?void 0:t.name)||""),O=Object(a.a)(h,2),f=O[0],p=O[1],m=Object(o.useState)((null===t||void 0===t?void 0:t.ifsc)||""),v=Object(a.a)(m,2),g=v[0],k=v[1],y=Object(o.useState)((null===t||void 0===t?void 0:t.city)||""),N=Object(a.a)(y,2),M=N[0],S=N[1],F=Object(o.useState)((null===t||void 0===t?void 0:t.accountType)||""),P=Object(a.a)(F,2),D=P[0],_=P[1],A=Object(o.useState)((null===t||void 0===t?void 0:t.accountNumber)||""),w=Object(a.a)(A,2),T=w[0],I=w[1];return Object(x.jsxs)("form",{className:"paymentMethodForm netBanking",onSubmit:function(e){e.preventDefault(),Object(C.updateProfileInfo)({"shopInfo.paymentMethod":{name:f,bank:u,city:M,accountType:D,ifsc:g,accountNumber:T}}).then((function(e){var t=e.user;t?(i((function(e){return Object(s.a)(Object(s.a)({},e),{},{shopInfo:t.shopInfo})})),c(!1)):n(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return n(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not update payment method. Please try again."})]})]}))})).catch((function(e){console.log(e),n(Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("button",{onClick:function(){return n(null)},children:"Okay"}),Object(x.jsxs)("div",{children:[Object(x.jsx)(d.i,{}),Object(x.jsx)("h4",{children:"Could not updated payment method. Make sure you're online."})]})]}))}))},children:[Object(x.jsxs)("section",{className:"inputs",children:[Object(x.jsx)("input",{type:"text",name:"name",placeholder:"Full name",value:f,onChange:function(e){return p(e.target.value)},required:!0}),Object(x.jsx)("input",{type:"text",name:"bank",placeholder:"Bank",value:u,onChange:function(e){return b(e.target.value)},required:!0}),Object(x.jsx)("input",{type:"text",name:"city",placeholder:"City",value:M,onChange:function(e){return S(e.target.value)},required:!0}),Object(x.jsx)("input",{type:"text",name:"type",placeholder:"Account type ie. Savings / Current",value:D,onChange:function(e){return _(e.target.value)},required:!0}),Object(x.jsx)("input",{type:"text",name:"accountNumber",placeholder:"Account Number",value:T,onChange:function(e){return I(e.target.value)},required:!0}),Object(x.jsx)("input",{type:"text",name:"ifsc",placeholder:"IFSC",value:g,onChange:function(e){return k(e.target.value)},required:!0})]}),Object(x.jsxs)("section",{className:"btns",children:[Object(x.jsx)("button",{type:"submit",children:"Save Changes"}),Object(x.jsx)("button",{type:"button",onClick:function(){return c(!1)},children:"Cancel"})]})]})};t.default=function(e){e.history,e.location,e.match;var t=Object(o.useContext)(j.d),n=t.user,c=t.userType,s=Object(o.useState)(null),i=Object(a.a)(s,2),r=i[0],l=(i[1],Object(o.useState)([])),h=Object(a.a)(l,2),O=h[0],p=h[1],m=Object(o.useState)(!1),k=Object(a.a)(m,2),C=k[0],N=k[1];return Object(o.useEffect)((function(){fetch("/api/categories").then((function(e){return e.json()})).then((function(e){p(e.categories)}))}),[]),Object(o.useEffect)((function(){var e,t,c,s,a,i,r,l;!(null===O||void 0===O?void 0:O.length)||!(null===(e=n.shopInfo)||void 0===e||null===(t=e.terms)||void 0===t?void 0:t.length)||void 0===(null===(c=n.shopInfo)||void 0===c?void 0:c.shippingCost)||null===(null===(s=n.shopInfo)||void 0===s?void 0:s.shippingCost)||void 0===(null===(a=n.shopInfo)||void 0===a?void 0:a.deliveryWithin)||null===(null===(i=n.shopInfo)||void 0===i?void 0:i.deliveryWithin)||void 0===(null===(r=n.shopInfo)||void 0===r?void 0:r.refundable)||Object.values((null===(l=n.shopInfo)||void 0===l?void 0:l.paymentMethod)||{}).length<6?N(!1):N(!0)}),[O,n]),Object(x.jsxs)(x.Fragment,{children:["buyer"===c&&Object(x.jsx)(b.a,{to:"/account/orders/current"}),Object(x.jsxs)("div",{className:"myShop",children:[Object(x.jsx)("div",{style:{display:"none"},children:Object(x.jsx)(d.H,{})}),Object(x.jsx)(d.D,{basepath:"/account/myShop/",tabs:[{label:"Products & Services",path:"products"},{label:"Orders",path:"orders"},{label:"Refunds",path:"refunds"},{label:"Campaigns",path:"campaigns"},{label:"FB Marketplace",path:"fbMarketplace"},{label:"Settings",path:"settings"}]}),Object(x.jsxs)(b.d,{children:[Object(x.jsx)(b.b,{path:"/account/myShop/products",children:Object(x.jsx)(A,{categories:O,shopSetupComplete:C})}),Object(x.jsx)(b.b,{path:"/account/myShop/orders/:_id",component:f.FullOrder}),Object(x.jsx)(b.b,{path:"/account/myShop/orders",children:Object(x.jsx)(f.default,{categories:O})}),Object(x.jsx)(b.b,{path:"/account/myShop/refunds/:_id",component:v}),Object(x.jsx)(b.b,{path:"/account/myShop/refunds",component:g}),Object(x.jsx)(b.b,{path:"/account/myShop/campaigns",component:y}),Object(x.jsx)(b.b,{path:"/account/myShop/fbMarketplace",component:P}),Object(x.jsx)(b.b,{path:"/account/myShop/settings",children:Object(x.jsx)(Y,{categories:O,setCategories:p})})]}),Object(x.jsx)(u.Modal,{className:"msg",open:r,children:r})]})]})}},198:function(e,t,n){},251:function(e,t,n){},256:function(e,t,n){}}]);
//# sourceMappingURL=15.eed6a3ee.chunk.js.map