(this["webpackJsonpdeliveryPay-react"]=this["webpackJsonpdeliveryPay-react"]||[]).push([[12],{178:function(e,t,n){"use strict";n.r(t);var s=n(4),c=n(3),l=n(1),i=n(8),a=n(6),r=n(7),j=n(2),o=n(29),d=n(28),u=n.n(d),b=n(0);n(249);var O=function(e){var t,n=e.milestone;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("div",{className:"clientDetail",children:[Object(b.jsxs)("div",{className:"profile",children:[Object(b.jsx)(j.n,{src:n.client.profileImg||"/profile-user.jpg"}),Object(b.jsx)("p",{className:"name",children:n.client.firstName+" "+n.client.lastName})]}),Object(b.jsx)("div",{className:"milestoneDetail",children:Object(b.jsxs)("ul",{children:[Object(b.jsxs)("li",{children:[Object(b.jsx)("p",{children:"Date"}),"-",Object(b.jsx)("p",{children:Object(b.jsx)(j.s,{format:"DD MMM, YYYY. hh:mm a",children:n.createdAt})})]}),Object(b.jsxs)("li",{children:[Object(b.jsx)("p",{children:"Role"}),"-",Object(b.jsx)("p",{className:"role",children:n.role})]}),Object(b.jsxs)("li",{children:[Object(b.jsx)("p",{children:"Desciption"}),"-",Object(b.jsx)("p",{children:n.dscr})]}),Object(b.jsxs)("li",{children:[Object(b.jsx)("p",{children:"Milestone ID"}),"-",Object(b.jsx)("p",{children:n._id})]}),Object(b.jsxs)("li",{className:"status",children:[Object(b.jsx)("p",{children:"Status"}),"-",Object(b.jsx)("p",{children:n.status})]})]})})]}),Object(b.jsxs)("ul",{className:"steps ".concat(n.status," ").concat(null===(t=n.dispute)||void 0===t?void 0:t.status),children:[Object(b.jsxs)("li",{className:"step pending",children:[Object(b.jsxs)("div",{className:"icons",children:[Object(b.jsx)(j.D,{className:"default"}),Object(b.jsx)(j.B,{className:"blank"}),Object(b.jsx)(j.C,{className:"filled"})]}),Object(b.jsx)("p",{children:"Deposite recieved"})]}),Object(b.jsxs)("li",{className:"progress pending",children:[Object(b.jsx)(j.w,{}),Object(b.jsx)(j.x,{}),Object(b.jsx)(j.y,{})]}),Object(b.jsxs)("li",{className:"step onhold",children:[Object(b.jsxs)("div",{className:"icons",children:[Object(b.jsx)(j.D,{className:"default"}),Object(b.jsx)(j.B,{className:"blank"}),Object(b.jsx)(j.C,{className:"filled"})]}),Object(b.jsx)("p",{children:"Funds on Hold"})]}),Object(b.jsxs)("li",{className:"progress onhold",children:[Object(b.jsx)(j.w,{}),Object(b.jsx)(j.x,{}),Object(b.jsx)(j.y,{})]}),Object(b.jsxs)("li",{className:"step released",children:[Object(b.jsxs)("div",{className:"icons",children:[Object(b.jsx)(j.D,{className:"default"}),Object(b.jsx)(j.B,{className:"blank"}),Object(b.jsx)(j.C,{className:"filled"})]}),Object(b.jsx)("p",{children:"Released"})]})]})]})},h=function(e){var t,n,i,d,u,h,x=e.milestone,m=e.setMilestones,p=(Object(a.g)(),Object(l.useState)(!1)),f=Object(c.a)(p,2),v=f[0],g=f[1],N=Object(l.useState)(!1),k=Object(c.a)(N,2),C=k[0],y=k[1],D=Object(l.useState)(null),M=Object(c.a)(D,2),_=M[0],F=M[1],R=null,S=null;(null===(t=x.dispute)||void 0===t?void 0:t.plaintiff._id)===x.client._id?(R=null===(d=x.dispute)||void 0===d||null===(u=d.defendant)||void 0===u||null===(h=u.case)||void 0===h?void 0:h.dscr,S="client"):(null===(n=x.dispute)||void 0===n?void 0:n.defendant._id)===x.client._id&&(S="self");var q=function(){fetch("/api/approveMilestone",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({milestone_id:x._id,amount:x.amount})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?m((function(t){return t.map((function(t){return t._id===e.milestone._id?Object(s.a)(Object(s.a)({},e.milestone),{},{client:x.client,role:x.role}):t}))})):403===e.code?F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not approve milestone due to low balance."})]})]})):F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not approve milestone. Please try again."})]})]}))})).catch((function(e){console.log(e),F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not approve milestone. Make sure you're online"})]})]}))}))},P=function(){fetch("/api/declineMilestoneBuyer",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({milestone_id:x._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?m((function(t){return t.map((function(t){return t._id===e.milestone._id?Object(s.a)(Object(s.a)({},e.milestone),{},{client:x.client,role:x.role}):t}))})):F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not decline milestone. Please try again."})]})]}))})).catch((function(e){console.log(e),F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not decline milestone. Make sure you're online"})]})]}))}))};return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("li",{className:"milestone seller",children:[Object(b.jsx)(O,{milestone:x}),Object(b.jsxs)("div",{className:"clas",children:[Object(b.jsxs)("h4",{children:["\u20b9",x.amount]}),Object(b.jsxs)("div",{className:"btns",children:["pending"===x.status&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("a",{onClick:function(){return Object(r.Confirm)({label:"Milestone Approval",question:"You sure want to approve this milestone?",callback:q})},children:"Approve"}),Object(b.jsx)("a",{className:"disputeRes",onClick:function(){return Object(r.Confirm)({label:"Milestone Decline",question:"You sure want to decline this milestone?",callback:P})},children:"Decline"})]}),"pendingRelease"===x.status&&Object(b.jsx)("a",{className:"released",children:"Release requested"}),("inProgress"===x.status||"pendingRelease"===x.status)&&Object(b.jsx)("a",{onClick:function(){return g(!0)},children:"Release"}),"released"===x.status&&Object(b.jsx)("a",{className:"dispute",onClick:function(){return y(!0)},children:"Raise Dispute"}),("client"===S&&R||"self"===S)&&Object(b.jsxs)("a",{className:"disputed",children:["Dispute ",null===(i=x.dispute)||void 0===i?void 0:i.status]}),"client"===S&&!R&&Object(b.jsx)("a",{className:"disputeRes",onClick:function(){return y(!0)},children:"Approve Dispute"}),"declined"===x.status&&Object(b.jsx)("a",{className:"disputed",children:"Declined"}),Object(b.jsx)(r.Modal,{open:_,className:"msg",children:_})]})]}),Object(b.jsx)(r.Modal,{open:v,head:!0,label:"Release Money",setOpen:g,className:"milestoneReleaseForm",children:Object(b.jsx)(o.MilestoneReleaseForm,{milestone:x,setReleaseForm:g,onSuccess:function(e){m((function(t){return t.map((function(t){return t._id===e._id?Object(s.a)(Object(s.a)({},e),{},{client:t.client,role:t.role}):t}))})),g(!1),F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsxs)("h4",{className:"amount",children:["\u20b9",e.amount]}),Object(b.jsx)("h4",{children:"Milestone has been released."})]})]}))}})}),Object(b.jsx)(r.Modal,{open:C,head:!0,label:"Raise Dispute",setOpen:y,className:"disputeForm",children:Object(b.jsx)(o.DisputeForm,{milestone:x,setDisputeForm:y,onSuccess:function(e){m((function(t){return t.map((function(t){return t._id===e._id?Object(s.a)(Object(s.a)({},e),{},{client:t.client,role:t.role}):t}))})),y(!1),F(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return F(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsx)("h4",{children:"client"===S?"Case submit success. Dispute pending for verdict.":"Dispute filed succefully."})]})]}))}})})]},x._id),Object(b.jsx)(r.Modal,{className:"msg",open:_,children:_})]})},x=function(e){var t,n,i,a,d,u,h=e.milestone,x=e.setMilestones,m=Object(l.useState)(!1),p=Object(c.a)(m,2),f=p[0],v=p[1],g=Object(l.useState)(null),N=Object(c.a)(g,2),k=N[0],C=N[1],y=null,D=null;(null===(t=h.dispute)||void 0===t?void 0:t.plaintiff._id)===h.client._id?(y=null===(a=h.dispute)||void 0===a||null===(d=a.defendant)||void 0===d||null===(u=d.case)||void 0===u?void 0:u.dscr,D="client"):(null===(n=h.dispute)||void 0===n?void 0:n.defendant._id)===h.client._id&&(D="self");var M=function(){fetch("/api/declineMilestone",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:h._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(x((function(t){return t.map((function(t){return t._id===e.milestone._id?Object(s.a)(Object(s.a)({},e.milestone),{},{client:h.client,role:h.role}):t}))})),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsx)("h4",{children:"Milestone succefully declined."})]})]}))):C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Milestone succefully declined."})]})]}))})).catch((function(e){console.log(e),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not decline milestone. Make sure you're online"})]})]}))}))},_=function(){fetch("/api/cancelMilestoneRequest",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:h._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(x((function(e){return e.filter((function(e){return e._id!==h._id}))})),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsx)("h4",{children:"Milestone request cancelled."})]})]}))):C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not cancel milestone request. Try again."})]})]}))})).catch((function(e){console.log(e),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not cancel milestone request. Make sure you're online."})]})]}))}))},F=function(){fetch("/api/requestRelease",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:h._id})}).then((function(e){return e.json()})).then((function(e){"ok"===e.code?(x((function(t){return t.map((function(t){return t._id===e.milestone._id?Object(s.a)(Object(s.a)({},e.milestone),{},{client:h.client,role:h.role}):t}))})),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsx)("h4",{children:"Milestone request cancelled."})]})]}))):C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not request release. Try again."})]})]}))})).catch((function(e){console.log(e),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not request release. Make sure you're online."})]})]}))}))};return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("li",{className:"milestone buyer",children:[Object(b.jsx)(O,{milestone:h}),Object(b.jsxs)("div",{className:"clas",children:[Object(b.jsxs)("h4",{children:["\u20b9",h.amount]}),Object(b.jsxs)("div",{className:"btns",children:["pendingRelease"===h.status&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("a",{className:"released",children:"Release requested"}),Object(b.jsx)("a",{className:"dispute",onClick:function(){return v(!0)},children:"Raise Dispute"})]}),"pending"===h.status&&Object(b.jsx)("a",{className:"disputeRes",onClick:function(){return Object(r.Confirm)({label:"Cancel Milestone request",question:"You sure want to cancel this request?",callback:_})},children:"Cancel Request"}),"released"===h.status&&Object(b.jsx)("a",{className:"released",children:"Released"}),("client"===D&&y||"self"===D)&&Object(b.jsxs)("a",{className:"disputed",children:["Dispute ",null===(i=h.dispute)||void 0===i?void 0:i.status]}),"client"===D&&!y&&Object(b.jsx)("a",{className:"disputeRes",onClick:function(){return v(!0)},children:"Approve Dispute"}),"inProgress"===h.status&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("a",{onClick:function(){return Object(r.Confirm)({label:"Request Release",question:"You sure want to request release of this milestone?",callback:F})},children:"Request Release"}),Object(b.jsx)("a",{className:"disputeRes",onClick:function(){return Object(r.Confirm)({label:"Decline Milestone",question:"You sure want to decline this milestone?",callback:M})},children:"Decline"})]}),"declined"===h.status&&Object(b.jsx)("a",{className:"disputed",children:"Declined"})]})]}),Object(b.jsx)(r.Modal,{open:f,head:!0,label:"Raise Dispute",setOpen:v,className:"disputeForm",children:Object(b.jsx)(o.DisputeForm,{milestone:h,setDisputeForm:v,onSuccess:function(e){x((function(t){return t.map((function(t){return t._id===e._id?Object(s.a)(Object(s.a)({},e),{},{client:t.client,role:t.role}):t}))})),v(!1),C(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return C(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.E,{}),Object(b.jsx)("h4",{children:"client"===D?"Case submit success. Dispute pending for verdict.":"Dispute filed succefully."})]})]}))}})})]},h._id),Object(b.jsx)(r.Modal,{className:"msg",open:k,children:k})]})};t.default=function(e){var t,n=e.history,a=e.location,o=(e.match,Object(l.useContext)(i.d).userType),d=Object(l.useState)([]),O=Object(c.a)(d,2),m=O[0],p=O[1],f=Object(l.useState)(null),v=Object(c.a)(f,2),g=v[0],N=v[1],k=Object(l.useState)(u.a.parse(a.search).page||1),C=Object(c.a)(k,2),y=C[0],D=C[1],M=Object(l.useState)(u.a.parse(a.search).perPage||20),_=Object(c.a)(M,2),F=_[0],R=_[1],S=Object(l.useState)((null===(t=u.a.parse(a.search).q)||void 0===t?void 0:t.replace(/\/(?!.*\/).*/,""))||""),q=Object(c.a)(S,2),P=q[0],w=q[1],Y=Object(l.useState)(u.a.parse(a.search).status||""),T=Object(c.a)(Y,2),A=T[0],E=T[1],J=Object(l.useState)(null),B=Object(c.a)(J,2),H=B[0],I=B[1],L=Object(l.useState)({column:u.a.parse(a.search).sort||"createdAt",order:u.a.parse(a.search).order||"dsc"}),V=Object(c.a)(L,2),Z=V[0],U=(V[1],Object(l.useState)(null)),z=Object(c.a)(U,2),G=z[0],K=z[1];return Object(l.useEffect)((function(){fetch("/api/milestone".concat(a.search)).then((function(e){return e.json()})).then((function(e){"ok"===e.code&&(p(e.milestones),N(e.total))})).catch((function(e){console.log(e),K(Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("button",{onClick:function(){return K(null)},children:"Okay"}),Object(b.jsxs)("div",{children:[Object(b.jsx)(j.i,{}),Object(b.jsx)("h4",{children:"Could not update milestones."})]})]}))}))}),[a.search,o]),Object(l.useEffect)((function(){var e,t=Object(j.N)({time:null===H||void 0===H?void 0:H.startDate,format:"YYYY-MM-DD"}),c=Object(j.N)({time:null===(e=new Date(null===H||void 0===H?void 0:H.endDate))||void 0===e?void 0:e.setHours(24,0,0,0),format:"YYYY-MM-DD"});n.replace({pathname:a.pathname,search:"?"+new URLSearchParams(Object(s.a)(Object(s.a)(Object(s.a)({page:y,perPage:F,sort:Z.column,order:Z.order},P&&{q:P}),H&&{dateFrom:t,dateTo:c}),A&&{status:A})).toString()})}),[y,F,Z.column,Z.order,P,H,A,o]),Object(b.jsxs)("div",{className:"holdContainer",children:[Object(b.jsx)("div",{style:{display:"none"},children:Object(b.jsx)(j.J,{})}),Object(b.jsxs)("div",{className:"benner",children:[Object(b.jsx)("h4",{children:"Secure your transactions"}),Object(b.jsx)("p",{children:"All payments and transactions come here"})]}),Object(b.jsx)("div",{className:"head",children:Object(b.jsxs)("div",{className:"filters",children:[Object(b.jsxs)("section",{children:[Object(b.jsx)("label",{children:"Total:"}),g]}),Object(b.jsxs)("section",{children:[Object(b.jsx)("label",{children:"Per Page:"}),Object(b.jsx)(j.h,{defaultValue:0,options:[{label:"20",value:20},{label:"30",value:30},{label:"50",value:50}],onChange:function(e){return R(e.value)}})]}),Object(b.jsxs)("section",{className:"search",children:[Object(b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"23",height:"23",viewBox:"0 0 23 23",children:Object(b.jsx)("path",{id:"Icon_ionic-ios-search","data-name":"Icon ionic-ios-search",d:"M27.23,25.828l-6.4-6.455a9.116,9.116,0,1,0-1.384,1.4L25.8,27.188a.985.985,0,0,0,1.39.036A.99.99,0,0,0,27.23,25.828ZM13.67,20.852a7.2,7.2,0,1,1,5.091-2.108A7.155,7.155,0,0,1,13.67,20.852Z",transform:"translate(-4.5 -4.493)",fill:"#707070",opacity:"0.74"})}),Object(b.jsx)("input",{value:P,onChange:function(e){return w(e.target.value)},placeholder:"Search Buyer's or Seller's name, phone, Milestone ID"}),P&&Object(b.jsx)("button",{onClick:function(){return w("")},children:Object(b.jsx)(j.J,{})})]}),Object(b.jsxs)("section",{className:"status",children:[Object(b.jsx)("label",{children:"Status:"}),Object(b.jsx)(j.h,{defaultValue:A||0,options:[{label:"All",value:""},{label:"In Progress",value:"inProgress"},{label:"Pending",value:"pending"},{label:"Release requested",value:"pendingRelease"},{label:"Released",value:"released"},{label:"Dispute",value:"dispute"}],onChange:function(e){return E(e.value)}})]}),Object(b.jsx)("section",{className:"date",children:Object(b.jsx)(j.o,{dateRange:H,onChange:function(e){return I(e)}})})]})}),Object(b.jsxs)("ul",{className:"milestones",children:[m.map((function(e,t){return"seller"===e.role?Object(b.jsx)(h,{milestone:e,setMilestones:p},t):Object(b.jsx)(x,{milestone:e,setMilestones:p},t)})),0===m.length&&Object(b.jsx)("p",{className:"placeholder",children:"No transaction yet."})]}),Object(b.jsx)(j.u,{total:g,perPage:F,currentPage:y,btns:5,setPage:D}),Object(b.jsx)(r.Modal,{className:"msg",open:G,children:G})]})}},249:function(e,t,n){}}]);
//# sourceMappingURL=12.b42f9713.chunk.js.map